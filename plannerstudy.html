<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Organize seus estudos de forma eficiente com o MedLife Study Planner">
    <meta name="theme-color" content="#0891b2">
    <title>Planejador de Estudos - MedLife</title>

    <!-- PWA Support -->
    <link rel="icon" type="image/png" sizes="512x512" href="favicon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="favicon.png">
    <link rel="apple-touch-icon" href="favicon.png">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        /* ===== CSS VARIABLES ===== */
        :root {
            /* Light Theme - Medical Modern */
            --primary: #0891b2;
            --primary-dark: #0e7490;
            --primary-light: #06b6d4;
            --secondary: #0284c7;
            --secondary-dark: #0369a1;
            --accent: #14b8a6;
            --success: #10b981;
            --success-dark: #059669;
            --danger: #ef4444;
            --danger-dark: #dc2626;
            --warning: #f59e0b;
            --info: #0ea5e9;

            --text: #0f172a;
            --text-secondary: #475569;
            --text-light: #94a3b8;

            --bg: linear-gradient(to bottom, #f0fdfa 0%, #f8fafc 100%);
            --bg-secondary: #ecfeff;
            --surface: #ffffff;
            --surface-elevated: #ffffff;
            --border: #e0f2fe;
            --border-light: #f0f9ff;

            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --shadow-xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);

            --radius-sm: 8px;
            --radius: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;

            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition: 250ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 350ms cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Dark Theme */
        [data-theme="dark"] {
            --text: #f9fafb;
            --text-secondary: #d1d5db;
            --text-light: #9ca3af;

            --bg: #0f172a;
            --bg-secondary: #1e293b;
            --surface: #1e293b;
            --surface-elevated: #334155;
            --border: #334155;
            --border-light: #475569;

            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.3);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.4), 0 2px 4px -1px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.4), 0 10px 10px -5px rgba(0, 0, 0, 0.3);
            --shadow-xl: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        /* ===== BASE STYLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(to bottom, #f0fdfa 0%, #f8fafc 100%);
            background-attachment: fixed;
            color: var(--text);
            line-height: 1.6;
            transition: all var(--transition);
            overflow-x: hidden;
            min-height: 100vh;
        }

        [data-theme="dark"] body {
            background: linear-gradient(to bottom, #0f172a 0%, #1e293b 100%);
            background-attachment: fixed;
        }

        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 24px;
        }

        /* ===== HEADER ===== */
        .header {
            background: linear-gradient(135deg, #0891b2 0%, #0284c7 50%, #14b8a6 100%);
            color: white;
            padding: 56px 0;
            margin-bottom: 40px;
            box-shadow: 0 20px 40px -10px rgba(8, 145, 178, 0.3);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                radial-gradient(circle at 20% 50%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 255, 255, 0.08) 0%, transparent 50%),
                url('data:image/svg+xml,<svg width="60" height="60" xmlns="http://www.w3.org/2000/svg"><path d="M30 15 L30 25 M25 20 L35 20" stroke="white" stroke-width="1.5" opacity="0.05"/><circle cx="30" cy="40" r="8" stroke="white" stroke-width="1.5" fill="none" opacity="0.05"/></svg>');
            animation: float 25s infinite linear;
        }

        @keyframes float {
            from { transform: translateX(0) translateY(0); }
            to { transform: translateX(100px) translateY(100px); }
        }

        .header-content {
            display: grid;
            gap: 40px;
            align-items: center;
            grid-template-columns: 1fr auto;
            position: relative;
            z-index: 1;
        }

        .header-main h1 {
            font-size: clamp(1.8rem, 5vw, 2.5rem);
            margin-bottom: 12px;
            line-height: 1.2;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header-main p {
            font-size: 1.1rem;
            opacity: 0.95;
            margin-bottom: 24px;
        }

        .header-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.18);
            backdrop-filter: blur(24px);
            padding: 22px;
            border-radius: var(--radius-lg);
            border: 1px solid rgba(255, 255, 255, 0.25);
            transition: all var(--transition);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .stat-card:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .stat-card p {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 8px;
        }

        .stat-card .value {
            font-size: 2rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* ===== BUTTONS ===== */
        .btn {
            padding: 13px 28px;
            border: none;
            border-radius: var(--radius);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition);
            font-size: 0.95rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-family: inherit;
            position: relative;
            overflow: hidden;
            letter-spacing: 0.3px;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width var(--transition-slow), height var(--transition-slow);
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn > * {
            position: relative;
            z-index: 1;
        }

        .btn-primary {
            background: linear-gradient(135deg, #0891b2 0%, #0284c7 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(8, 145, 178, 0.25);
        }

        .btn-primary:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 8px 20px rgba(8, 145, 178, 0.35);
            background: linear-gradient(135deg, #06b6d4 0%, #0284c7 100%);
        }

        .btn-primary:active {
            transform: translateY(0) scale(0.98);
        }

        .btn-secondary {
            background: var(--surface);
            color: var(--text);
            border: 2px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--bg-secondary);
            border-color: var(--primary);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: var(--success-dark);
            transform: translateY(-2px);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: var(--danger-dark);
        }

        .btn-ghost {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .btn-ghost:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .btn-icon {
            width: 44px;
            height: 44px;
            padding: 0;
            border-radius: 50%;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.875rem;
        }

        .btn-full {
            width: 100%;
        }

        /* ===== THEME TOGGLE ===== */
        .theme-toggle {
            position: relative;
            width: 60px;
            height: 32px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            cursor: pointer;
            border: 2px solid rgba(255, 255, 255, 0.3);
            transition: all var(--transition);
        }

        .theme-toggle::after {
            content: 'üåô';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            transition: all var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        [data-theme="dark"] .theme-toggle::after {
            content: '‚òÄÔ∏è';
            transform: translateX(28px);
        }

        /* ===== TABS ===== */
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 32px;
            background: var(--surface);
            padding: 10px;
            border-radius: var(--radius-lg);
            box-shadow: 0 4px 16px rgba(8, 145, 178, 0.08);
            flex-wrap: wrap;
            position: relative;
            border: 1px solid rgba(8, 145, 178, 0.08);
        }

        .tab-btn {
            flex: 1;
            min-width: 120px;
            padding: 12px 20px;
            border: none;
            background: transparent;
            border-radius: var(--radius);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition);
            color: var(--text-secondary);
            font-size: 0.95rem;
            position: relative;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #0891b2 0%, #0284c7 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(8, 145, 178, 0.25);
        }

        .tab-btn:hover:not(.active) {
            background: var(--bg-secondary);
            color: var(--text);
        }

        /* ===== SEARCH BAR ===== */
        .search-container {
            background: var(--surface);
            padding: 24px;
            border-radius: var(--radius-lg);
            box-shadow: 0 4px 16px rgba(8, 145, 178, 0.08);
            margin-bottom: 24px;
            border: 1px solid rgba(8, 145, 178, 0.08);
        }

        .search-wrapper {
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 15px 48px 15px 48px;
            border: 2px solid var(--border);
            border-radius: var(--radius);
            font-size: 1rem;
            font-family: inherit;
            transition: all var(--transition);
            background: var(--surface);
            color: var(--text);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(8, 145, 178, 0.12);
        }

        .search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            pointer-events: none;
        }

        .search-clear {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 4px;
            display: none;
        }

        .search-input:not(:placeholder-shown) ~ .search-clear {
            display: block;
        }

        .filter-tags {
            display: flex;
            gap: 8px;
            margin-top: 16px;
            flex-wrap: wrap;
        }

        .filter-tag {
            padding: 7px 16px;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition);
            border: 2px solid var(--border);
            background: var(--surface);
            color: var(--text-secondary);
            letter-spacing: 0.2px;
        }

        .filter-tag.active {
            background: linear-gradient(135deg, #0891b2 0%, #0284c7 100%);
            color: white;
            border-color: transparent;
            box-shadow: 0 2px 8px rgba(8, 145, 178, 0.25);
        }

        .filter-tag:hover:not(.active) {
            border-color: var(--primary);
            color: var(--primary);
            transform: translateY(-1px);
        }

        /* ===== CARDS ===== */
        .card {
            background: var(--surface);
            border-radius: var(--radius-lg);
            padding: 32px;
            box-shadow: 0 4px 16px rgba(8, 145, 178, 0.08);
            margin-bottom: 24px;
            transition: all var(--transition);
            border: 1px solid rgba(8, 145, 178, 0.08);
        }

        .card:hover {
            box-shadow: 0 8px 24px rgba(8, 145, 178, 0.12);
            transform: translateY(-2px);
            border-color: rgba(8, 145, 178, 0.15);
        }

        .card h2 {
            font-size: 1.75rem;
            margin-bottom: 24px;
            color: var(--text);
            font-weight: 700;
        }

        /* ===== FORMS ===== */
        .form-group {
            margin-bottom: 24px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text);
            font-size: 0.95rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid var(--border);
            border-radius: var(--radius);
            font-size: 1rem;
            font-family: inherit;
            transition: all var(--transition);
            background: var(--surface);
            color: var(--text);
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(8, 145, 178, 0.15);
            background: var(--surface);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        /* ===== CONTENT ITEMS ===== */
        .main-grid {
            display: grid;
            grid-template-columns: 320px 1fr;
            gap: 24px;
            margin-bottom: 32px;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .subject-list {
            background: var(--surface);
            border-radius: var(--radius-lg);
            padding: 24px;
            box-shadow: var(--shadow);
            position: sticky;
            top: 24px;
        }

        .subject-list h3 {
            font-size: 1.25rem;
            margin-bottom: 16px;
            color: var(--text);
            font-weight: 700;
        }

        .subject-item {
            padding: 12px 16px;
            background: var(--bg);
            border-radius: var(--radius);
            margin-bottom: 8px;
            cursor: pointer;
            transition: all var(--transition);
            border-left: 3px solid transparent;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .subject-item:hover {
            background: var(--bg-secondary);
            border-left-color: var(--primary);
            transform: translateX(4px);
        }

        .subject-item.active {
            background: linear-gradient(135deg, rgba(79, 70, 229, 0.1), rgba(124, 58, 237, 0.1));
            border-left-color: var(--primary);
            font-weight: 600;
            color: var(--primary);
        }

        .subject-item-delete {
            background: none;
            border: none;
            color: var(--danger);
            cursor: pointer;
            font-size: 1.2rem;
            padding: 4px;
            opacity: 0;
            transition: opacity var(--transition);
            border-radius: 4px;
        }

        .subject-item-delete:hover {
            background: rgba(239, 68, 68, 0.1);
        }

        .subject-item:hover .subject-item-delete {
            opacity: 1;
        }

        .content-item {
            background: var(--surface);
            border-radius: var(--radius-lg);
            padding: 24px;
            margin-bottom: 20px;
            border-left: 4px solid var(--primary);
            box-shadow: 0 2px 12px rgba(8, 145, 178, 0.1);
            transition: all var(--transition);
            animation: slideUp var(--transition);
            border: 1px solid rgba(8, 145, 178, 0.1);
            border-left: 4px solid var(--primary);
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .content-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(8, 145, 178, 0.18);
            border-color: rgba(8, 145, 178, 0.2);
        }

        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
            gap: 16px;
        }

        .content-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text);
        }

        .badges {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 7px 14px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            transition: all var(--transition);
            letter-spacing: 0.3px;
        }

        .badge-subject {
            background: linear-gradient(135deg, rgba(8, 145, 178, 0.12), rgba(2, 132, 199, 0.12));
            color: var(--primary);
            border: 1px solid rgba(8, 145, 178, 0.25);
        }

        .badge-difficulty-easy {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .badge-difficulty-medium {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
            border: 1px solid rgba(245, 158, 11, 0.2);
        }

        .badge-difficulty-hard {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        .badge-time {
            background: rgba(2, 132, 199, 0.1);
            color: var(--secondary);
            border: 1px solid rgba(2, 132, 199, 0.25);
        }

        .content-text {
            color: var(--text-secondary);
            margin-bottom: 16px;
            line-height: 1.6;
        }

        .content-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .checkbox-wrapper {
            width: 24px;
            height: 24px;
            position: relative;
        }

        .checkbox-wrapper input[type="checkbox"] {
            width: 24px;
            height: 24px;
            cursor: pointer;
            appearance: none;
            border: 2px solid var(--border);
            border-radius: 6px;
            background: var(--surface);
            transition: all var(--transition);
        }

        .checkbox-wrapper input[type="checkbox"]:checked {
            background: var(--success);
            border-color: var(--success);
        }

        .checkbox-wrapper input[type="checkbox"]:checked::after {
            content: '‚úì';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
        }

        /* ===== MODAL ===== */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeIn var(--transition);
        }

        .modal-overlay.show {
            display: flex;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .modal {
            background: var(--surface);
            border-radius: var(--radius-xl);
            padding: 36px;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(8, 145, 178, 0.15);
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: slideDown var(--transition-slow);
            border: 1px solid rgba(8, 145, 178, 0.1);
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 16px;
            color: var(--text);
        }

        .modal-body {
            margin-bottom: 24px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        /* ===== TOAST NOTIFICATIONS ===== */
        .toast-container {
            position: fixed;
            top: 24px;
            right: 24px;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-width: 400px;
        }

        .toast {
            background: var(--surface);
            padding: 18px 24px;
            border-radius: var(--radius-lg);
            box-shadow: 0 8px 24px rgba(8, 145, 178, 0.15);
            display: flex;
            align-items: center;
            gap: 14px;
            animation: slideInRight var(--transition);
            border-left: 4px solid var(--primary);
            border: 1px solid rgba(8, 145, 178, 0.15);
            border-left: 4px solid var(--primary);
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .toast.success {
            border-left-color: var(--success);
        }

        .toast.error {
            border-left-color: var(--danger);
        }

        .toast.warning {
            border-left-color: var(--warning);
        }

        .toast-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 600;
            margin-bottom: 2px;
            color: var(--text);
        }

        .toast-message {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .toast-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 4px;
            font-size: 1.25rem;
            transition: color var(--transition);
        }

        .toast-close:hover {
            color: var(--text);
        }

        /* ===== STATS ===== */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .stat-box {
            background: var(--surface);
            padding: 24px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow);
            text-align: center;
            transition: all var(--transition);
            position: relative;
            overflow: hidden;
        }

        .stat-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
        }

        .stat-box:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .stat-box h4 {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-box .value {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* ===== CHARTS ===== */
        .chart-container {
            background: var(--surface);
            padding: 24px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow);
            margin-bottom: 32px;
        }

        .chart-container h3 {
            margin-bottom: 24px;
            color: var(--text);
            font-weight: 700;
        }

        .simple-bar {
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            height: 250px;
            gap: 16px;
        }

        .bar-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            gap: 8px;
        }

        .bar {
            width: 100%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: var(--radius-sm) var(--radius-sm) 0 0;
            min-height: 20px;
            transition: all var(--transition);
            cursor: pointer;
            position: relative;
        }

        .bar:hover {
            filter: brightness(1.1);
            transform: scaleY(1.05);
        }

        .bar-label {
            margin-top: 8px;
            font-size: 0.875rem;
            color: var(--text-secondary);
            text-align: center;
            font-weight: 500;
        }

        .bar-value {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text);
        }

        /* ===== RANKING ===== */
        .ranking-container {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .ranking-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: var(--background);
            border-radius: var(--radius-md);
            transition: all var(--transition);
            border: 2px solid transparent;
        }

        .ranking-item:hover {
            transform: translateX(4px);
            border-color: var(--primary);
        }

        .ranking-item.first {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 193, 7, 0.1));
            border-color: #FFD700;
        }

        .ranking-item.second {
            background: linear-gradient(135deg, rgba(192, 192, 192, 0.1), rgba(169, 169, 169, 0.1));
            border-color: #C0C0C0;
        }

        .ranking-item.third {
            background: linear-gradient(135deg, rgba(205, 127, 50, 0.1), rgba(184, 115, 51, 0.1));
            border-color: #CD7F32;
        }

        .ranking-position {
            font-size: 1.5rem;
            font-weight: 700;
            min-width: 40px;
            text-align: center;
            color: var(--text);
        }

        .ranking-crown {
            font-size: 2rem;
            animation: crownBounce 2s infinite;
        }

        @keyframes crownBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .ranking-info {
            flex: 1;
        }

        .ranking-subject {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 4px;
        }

        .ranking-hours {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .ranking-badge {
            padding: 8px 16px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: var(--radius-full);
            font-weight: 600;
            font-size: 0.875rem;
        }

        /* ===== EMPTY STATE ===== */
        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-state p {
            font-size: 1.1rem;
            margin-bottom: 12px;
        }

        /* ===== SUCCESS MESSAGE ===== */
        .success-message {
            background: linear-gradient(135deg, var(--success), var(--success-dark));
            color: white;
            padding: 40px;
            border-radius: var(--radius-lg);
            text-align: center;
            margin: 32px 0;
            box-shadow: var(--shadow-lg);
            animation: slideUp var(--transition);
        }

        .success-message h2 {
            font-size: 2rem;
            margin-bottom: 12px;
            color: white;
        }

        /* ===== SCREENS ===== */
        .screen {
            display: none;
        }

        .screen.active {
            display: block;
            animation: fadeIn var(--transition);
        }

        /* ===== LOADING ===== */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ===== WEEKLY AGENDA STYLES ===== */
        .weekly-agenda-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid var(--border);
        }

        .weekly-agenda-title {
            text-align: center;
            flex: 1;
        }

        .weekly-agenda-title h2 {
            margin: 0;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text);
        }

        .weekly-agenda-title .text-secondary {
            margin: 0;
            margin-top: 0.25rem;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .btn-icon {
            padding: 0.5rem;
            min-width: auto;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .weekly-planner {
            margin-top: 1.5rem;
        }

        .week-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .day-column {
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: var(--radius);
            padding: 1rem;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            transition: all var(--transition);
        }

        .day-column:hover {
            border-color: var(--primary-light);
            box-shadow: var(--shadow);
        }

        .day-column.today {
            border-color: var(--primary);
            background: linear-gradient(135deg, var(--surface) 0%, rgba(79, 70, 229, 0.05) 100%);
        }

        .day-header {
            text-align: center;
            padding-bottom: 0.75rem;
            margin-bottom: 0.75rem;
            border-bottom: 2px solid var(--border-light);
        }

        .day-name {
            font-size: 0.875rem;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--text-secondary);
            letter-spacing: 0.5px;
        }

        .day-column.today .day-name {
            color: var(--primary);
        }

        .day-date {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text);
            margin-top: 0.25rem;
        }

        .day-column.today .day-date {
            color: var(--primary);
        }

        .day-month {
            font-size: 0.75rem;
            color: var(--text-light);
            margin-top: 0.125rem;
        }

        .reviews-list {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            overflow-y: auto;
        }

        .review-item-mini {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            padding: 0.75rem;
            transition: all var(--transition);
            cursor: pointer;
        }

        .review-item-mini:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
            border-color: var(--primary-light);
        }

        .review-item-mini.completed {
            opacity: 0.6;
            background: var(--surface);
        }

        .review-item-mini.completed:hover {
            opacity: 0.8;
        }

        .review-mini-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .review-number-badge {
            background: var(--primary);
            color: white;
            font-size: 0.625rem;
            font-weight: 700;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            white-space: nowrap;
        }

        .review-item-mini.completed .review-number-badge {
            background: var(--success);
        }

        .review-mini-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            flex: 1;
        }

        .review-mini-subject {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        .review-mini-actions {
            display: flex;
            gap: 0.375rem;
            margin-top: 0.5rem;
        }

        .review-mini-actions button {
            flex: 1;
            padding: 0.375rem;
            font-size: 0.75rem;
            min-width: auto;
        }

        .day-reviews-count {
            text-align: center;
            padding: 0.5rem;
            margin-top: 0.5rem;
            background: var(--bg);
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .day-column.today .day-reviews-count {
            background: rgba(79, 70, 229, 0.1);
            color: var(--primary);
        }

        .empty-day {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-light);
            font-size: 0.75rem;
            text-align: center;
            padding: 1rem;
        }

        /* ===== POMODORO STYLES ===== */
        .pomodoro-levels {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .level-btn {
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 20px 16px;
            text-align: center;
            cursor: pointer;
            transition: all var(--transition);
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .level-btn:hover {
            border-color: var(--primary-light);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .level-btn.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-color: var(--primary);
            color: white;
        }

        .level-icon {
            font-size: 2rem;
            margin-bottom: 4px;
        }

        .level-name {
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 4px;
        }

        .level-time {
            font-size: 1.1rem;
            font-weight: 700;
        }

        .level-break {
            font-size: 0.75rem;
            opacity: 0.8;
        }

        .level-btn.active .level-name,
        .level-btn.active .level-time,
        .level-btn.active .level-break {
            color: white;
        }

        .pomodoro-timer-container {
            background: linear-gradient(135deg, rgba(8, 145, 178, 0.03) 0%, rgba(2, 132, 199, 0.03) 100%);
            border: 2px solid rgba(8, 145, 178, 0.15);
            border-radius: var(--radius-xl);
            padding: 48px 40px;
            margin: 32px 0;
            text-align: center;
            box-shadow: 0 4px 16px rgba(8, 145, 178, 0.08);
        }

        .pomodoro-display {
            margin-bottom: 32px;
        }

        .timer-type {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 16px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .timer-display {
            font-size: 5rem;
            font-weight: 800;
            color: var(--text);
            font-variant-numeric: tabular-nums;
            line-height: 1;
            margin-bottom: 16px;
        }

        .session-info {
            font-size: 1rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .pomodoro-controls {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 24px;
        }

        .pomodoro-progress {
            margin-top: 24px;
        }

        .progress-bar {
            background: var(--bg-secondary);
            height: 8px;
            border-radius: 99px;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
            height: 100%;
            width: 0%;
            transition: width 1s linear;
            border-radius: 99px;
        }

        .pomodoro-history {
            margin-top: 32px;
            padding-top: 32px;
            border-top: 2px solid var(--border);
        }

        .pomodoro-history h3 {
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: var(--text);
        }

        .pomodoro-session-item {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all var(--transition);
        }

        .pomodoro-session-item:hover {
            border-color: var(--primary-light);
            transform: translateX(4px);
        }

        .pomodoro-session-details {
            flex: 1;
        }

        .pomodoro-session-title {
            font-weight: 600;
            color: var(--text);
            margin-bottom: 4px;
        }

        .pomodoro-session-meta {
            font-size: 0.875rem;
            color: var(--text-secondary);
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .pomodoro-session-time {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary);
        }

        /* ===== POMODORO MODAL ===== */
        .pomodoro-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }

        .pomodoro-modal-overlay.show {
            display: flex;
        }

        .pomodoro-modal {
            background: var(--bg);
            border: 2px solid var(--primary);
            border-radius: var(--radius-xl);
            padding: 32px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .pomodoro-modal-icon {
            font-size: 4rem;
            text-align: center;
            margin-bottom: 16px;
        }

        .pomodoro-modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text);
            text-align: center;
            margin-bottom: 12px;
        }

        .pomodoro-modal-message {
            font-size: 1rem;
            color: var(--text-secondary);
            text-align: center;
            margin-bottom: 24px;
            line-height: 1.6;
        }

        .pomodoro-modal-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .pomodoro-modal-btn {
            padding: 12px 24px;
            border-radius: var(--radius);
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            border: none;
            transition: all var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .pomodoro-modal-btn-primary {
            background: var(--primary);
            color: white;
        }

        .pomodoro-modal-btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .pomodoro-modal-btn-secondary {
            background: var(--surface);
            color: var(--text);
            border: 2px solid var(--border);
        }

        .pomodoro-modal-btn-secondary:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 280px 1fr;
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 32px 0;
            }

            .header-content {
                grid-template-columns: 1fr;
            }

            .header-main h1 {
                font-size: 1.75rem;
            }

            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }

            .main-grid {
                grid-template-columns: 1fr;
            }

            .subject-list {
                position: static;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .stats-container {
                grid-template-columns: 1fr;
            }

            .card {
                padding: 24px;
            }

            .modal {
                padding: 24px;
            }

            .tabs {
                gap: 6px;
                padding: 6px;
            }

            .tab-btn {
                min-width: 90px;
                padding: 10px 14px;
                font-size: 0.875rem;
            }

            .toast-container {
                left: 16px;
                right: 16px;
                max-width: none;
            }

            .simple-bar {
                height: 200px;
            }

            .week-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            .weekly-agenda-header {
                flex-wrap: wrap;
            }

            .weekly-agenda-title {
                order: -1;
                width: 100%;
                margin-bottom: 1rem;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 0 16px;
            }

            .header-actions {
                flex-direction: column;
                width: 100%;
            }

            .btn {
                width: 100%;
            }

            .content-actions {
                flex-direction: column;
            }

            .modal-actions {
                flex-direction: column;
            }

            .modal-actions .btn {
                width: 100%;
            }

            .week-grid {
                grid-template-columns: 1fr;
            }

            .day-column {
                min-height: auto;
            }

            .weekly-agenda-header {
                gap: 0.5rem;
            }

            .btn-icon {
                width: 36px;
                height: 36px;
            }
        }

        /* ===== REVIEW OPTIONS ===== */
        .review-option:has(input:checked) {
            border-color: var(--primary) !important;
            background: linear-gradient(135deg, rgba(79, 70, 229, 0.05), rgba(124, 58, 237, 0.05)) !important;
        }

        .review-option:hover {
            border-color: var(--primary);
            transform: translateX(4px);
        }

        /* ===== UTILITIES ===== */
        .text-center {
            text-align: center;
        }

        .mb-0 {
            margin-bottom: 0 !important;
        }

        .mt-4 {
            margin-top: 16px;
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Modal Overlay -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <h3 class="modal-header" id="modalTitle">Confirmar A√ß√£o</h3>
            <div class="modal-body" id="modalBody">
                Tem certeza que deseja continuar?
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="modalCancel">Cancelar</button>
                <button class="btn btn-danger" id="modalConfirm">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="header-main">
                    <h1>
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                            <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                        </svg>
                        Planejador de Estudos
                    </h1>
                    <p id="headerUserInfo" style="display: none; font-size: 1rem; margin-bottom: 12px; font-weight: 600;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline-block; vertical-align: middle; margin-right: 8px;">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                        <span id="headerUserName"></span> - <span id="headerUserCourse"></span>
                    </p>
                    <p>Organize seu aprendizado de forma eficiente e moderna</p>
                    <div class="header-actions">
                        <button class="btn btn-ghost" onclick="window.location.href='/'">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M19 12H5M12 19l-7-7 7-7"/>
                            </svg>
                            Voltar
                        </button>
                        <button class="btn btn-ghost" onclick="app.exportData()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="7 10 12 15 17 10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                            Exportar
                        </button>
                        <div class="theme-toggle" onclick="app.toggleTheme()" role="button" aria-label="Toggle dark mode"></div>
                    </div>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <p>Disciplinas</p>
                        <div class="value">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                <line x1="16" y1="2" x2="16" y2="6"></line>
                                <line x1="8" y1="2" x2="8" y2="6"></line>
                                <line x1="3" y1="10" x2="21" y2="10"></line>
                            </svg>
                            <span id="headerSubjectCount">0</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <p>Conte√∫dos</p>
                        <div class="value">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14 2 14 8 20 8"></polyline>
                                <line x1="16" y1="13" x2="8" y2="13"></line>
                                <line x1="16" y1="17" x2="8" y2="17"></line>
                                <polyline points="10 9 9 9 8 9"></polyline>
                            </svg>
                            <span id="headerContentCount">0</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Tabs -->
        <nav class="tabs" role="tablist">
            <button class="tab-btn" data-tab="profile" role="tab" aria-selected="false">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                </svg>
                Perfil
            </button>
            <button class="tab-btn active" data-tab="dashboard" role="tab" aria-selected="true">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="7" height="7"></rect>
                    <rect x="14" y="3" width="7" height="7"></rect>
                    <rect x="14" y="14" width="7" height="7"></rect>
                    <rect x="3" y="14" width="7" height="7"></rect>
                </svg>
                Dashboard
            </button>
            <button class="tab-btn" data-tab="weeklyAgenda" role="tab" aria-selected="false">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="16" y1="2" x2="16" y2="6"></line>
                    <line x1="8" y1="2" x2="8" y2="6"></line>
                    <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
                Agenda da Semana
            </button>
            <button class="tab-btn" data-tab="addContent" role="tab" aria-selected="false">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                Adicionar Conte√∫do
            </button>
            <button class="tab-btn" data-tab="study" role="tab" aria-selected="false">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
                Sess√£o de Estudo
            </button>
            <button class="tab-btn" data-tab="pomodoro" role="tab" aria-selected="false">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
                Pomodoro
            </button>
            <button class="tab-btn" data-tab="review" role="tab" aria-selected="false">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="23 4 23 10 17 10"></polyline>
                    <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
                </svg>
                Revis√µes
            </button>
            <button class="tab-btn" data-tab="stats" role="tab" aria-selected="false">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="20" x2="18" y2="10"></line>
                    <line x1="12" y1="20" x2="12" y2="4"></line>
                    <line x1="6" y1="20" x2="6" y2="14"></line>
                </svg>
                Estat√≠sticas
            </button>
        </nav>

        <!-- Profile Screen -->
        <div id="profile" class="screen">
            <div class="card">
                <h2>Configurar Perfil</h2>
                <form id="profileForm">
                    <div class="form-group">
                        <label for="profileName">Nome *</label>
                        <input type="text" id="profileName" placeholder="Digite seu nome" required />
                    </div>

                    <div class="form-group">
                        <label for="profileSchool">Universidade/Escola *</label>
                        <input type="text" id="profileSchool" placeholder="Digite sua universidade ou escola" required />
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="profileCourse">Curso *</label>
                            <input type="text" id="profileCourse" placeholder="Digite seu curso" required />
                        </div>

                        <div class="form-group">
                            <label for="profilePeriod">Semestre/Bimestre *</label>
                            <input type="text" id="profilePeriod" placeholder="Ex: 3¬∫ Semestre" required />
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary btn-full">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                            <polyline points="17 21 17 13 7 13 7 21"></polyline>
                            <polyline points="7 3 7 8 15 8"></polyline>
                        </svg>
                        Salvar Perfil
                    </button>
                </form>
                <div id="profileDisplay" class="mt-4" style="display: none;">
                    <h3 style="margin-bottom: 16px;">Meu Perfil</h3>
                    <div style="background: var(--bg); padding: 20px; border-radius: var(--radius); border-left: 4px solid var(--primary);">
                        <p style="margin-bottom: 8px;"><strong>Nome:</strong> <span id="displayName"></span></p>
                        <p style="margin-bottom: 8px;"><strong>Universidade/Escola:</strong> <span id="displaySchool"></span></p>
                        <p style="margin-bottom: 8px;"><strong>Curso:</strong> <span id="displayCourse"></span></p>
                        <p><strong>Semestre/Bimestre:</strong> <span id="displayPeriod"></span></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dashboard Screen -->
        <div id="dashboard" class="screen active">
            <div class="main-grid">
                <!-- Sidebar -->
                <aside class="sidebar">
                    <div class="subject-list">
                        <h3>Disciplinas</h3>
                        <div id="subjectsList"></div>
                        <div class="form-group mt-4">
                            <input
                                type="text"
                                id="newSubject"
                                placeholder="Nova disciplina..."
                                aria-label="Nome da nova disciplina"
                            />
                        </div>
                        <button class="btn btn-primary btn-full btn-small" onclick="app.addSubject()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            Adicionar
                        </button>
                    </div>
                </aside>

                <!-- Main Content -->
                <main>
                    <!-- Search Bar -->
                    <div class="search-container">
                        <div class="search-wrapper">
                            <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"></circle>
                                <path d="m21 21-4.35-4.35"></path>
                            </svg>
                            <input
                                type="text"
                                class="search-input"
                                id="searchInput"
                                placeholder="Buscar conte√∫dos..."
                                aria-label="Buscar conte√∫dos"
                            />
                            <button class="search-clear" onclick="app.clearSearch()" aria-label="Limpar busca">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="18" y1="6" x2="6" y2="18"></line>
                                    <line x1="6" y1="6" x2="18" y2="18"></line>
                                </svg>
                            </button>
                        </div>
                        <div class="filter-tags">
                            <div class="filter-tag active" data-filter="all">Todos</div>
                            <div class="filter-tag" data-filter="pending">Pendentes</div>
                            <div class="filter-tag" data-filter="completed">Completados</div>
                            <div class="filter-tag" data-filter="easy">F√°cil</div>
                            <div class="filter-tag" data-filter="medium">M√©dio</div>
                            <div class="filter-tag" data-filter="hard">Dif√≠cil</div>
                        </div>
                    </div>

                    <div id="contentList"></div>
                    <div id="emptyState" class="empty-state">
                        <div class="empty-state-icon">üìö</div>
                        <p>Nenhum conte√∫do encontrado</p>
                        <p>Comece adicionando um novo conte√∫do</p>
                    </div>
                </main>
            </div>
        </div>

        <!-- Weekly Agenda Screen -->
        <div id="weeklyAgenda" class="screen">
            <div class="card">
                <div class="weekly-agenda-header">
                    <button class="btn btn-secondary btn-icon" onclick="app.previousWeek()" aria-label="Semana anterior">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="15 18 9 12 15 6"></polyline>
                        </svg>
                    </button>
                    <div class="weekly-agenda-title">
                        <h2 id="weekTitle">Agenda da Semana</h2>
                        <p id="weekRange" class="text-secondary"></p>
                    </div>
                    <button class="btn btn-secondary btn-icon" onclick="app.nextWeek()" aria-label="Pr√≥xima semana">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="9 18 15 12 9 6"></polyline>
                        </svg>
                    </button>
                    <button class="btn btn-primary" onclick="app.goToCurrentWeek()" style="margin-left: auto;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                            <line x1="3" y1="10" x2="21" y2="10"></line>
                        </svg>
                        Hoje
                    </button>
                </div>

                <div class="weekly-planner">
                    <div class="week-grid" id="weekGrid">
                        <!-- Days will be rendered here by JavaScript -->
                    </div>
                </div>

                <div id="emptyWeekState" class="empty-state" style="display: none;">
                    <div class="empty-state-icon">üìÖ</div>
                    <p>Nenhuma revis√£o agendada para esta semana</p>
                    <p>Continue estudando para gerar novas revis√µes!</p>
                </div>
            </div>
        </div>

        <!-- Add Content Screen -->
        <div id="addContent" class="screen">
            <div class="card">
                <h2>Adicionar Novo Conte√∫do</h2>
                <form id="contentForm">
                    <div class="form-group">
                        <label for="contentSubject">Disciplina *</label>
                        <select id="contentSubject" required>
                            <option value="">Selecione uma disciplina</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="contentTitle">T√≠tulo *</label>
                        <input
                            type="text"
                            id="contentTitle"
                            placeholder="Digite o t√≠tulo do conte√∫do"
                            required
                        />
                    </div>

                    <div class="form-group">
                        <label for="contentDifficulty">N√≠vel de Dificuldade *</label>
                        <select id="contentDifficulty" required>
                            <option value="easy">F√°cil</option>
                            <option value="medium" selected>M√©dio</option>
                            <option value="hard">Dif√≠cil</option>
                        </select>
                    </div>

                    <button type="submit" class="btn btn-primary btn-full">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        Adicionar Conte√∫do
                    </button>
                </form>
            </div>
        </div>

        <!-- Study Session Screen -->
        <div id="study" class="screen">
            <div class="card">
                <h2>Iniciar Sess√£o de Estudo</h2>
                <form id="studySessionForm">
                    <input type="hidden" id="editingSessionId" value="" />
                    <div class="form-group">
                        <label for="studyContent">Conte√∫do *</label>
                        <select id="studyContent" required>
                            <option value="">Selecione um conte√∫do</option>
                        </select>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="studyDate">Data *</label>
                            <input type="date" id="studyDate" required />
                        </div>

                        <div class="form-group">
                            <label for="studyStartTime">Hora de In√≠cio *</label>
                            <input type="time" id="studyStartTime" required />
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="studyEndTime">Hora de T√©rmino *</label>
                        <input type="time" id="studyEndTime" required />
                    </div>

                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" id="enableSpacedReview" style="width: auto; cursor: pointer;" />
                            <span>Desejo fazer revis√µes espa√ßadas</span>
                        </label>
                    </div>

                    <div id="spacedReviewOptions" style="display: none; margin-top: -8px;">
                        <div class="form-group">
                            <label style="margin-bottom: 12px;">Escolha o intervalo de revis√µes:</label>
                            <div style="display: flex; flex-direction: column; gap: 12px;">
                                <label style="display: flex; align-items: flex-start; gap: 8px; cursor: pointer; padding: 12px; background: var(--bg); border-radius: var(--radius); border: 2px solid var(--border); transition: all var(--transition);" class="review-option">
                                    <input type="radio" name="reviewInterval" value="option1" style="width: auto; cursor: pointer; margin-top: 4px;" checked />
                                    <div>
                                        <strong>Op√ß√£o 1:</strong> 24 horas, 7 dias, 30 dias, 90 dias
                                        <div style="font-size: 0.875rem; color: var(--text-secondary); margin-top: 4px;">Ideal para conte√∫dos que voc√™ precisa fixar a longo prazo</div>
                                    </div>
                                </label>
                                <label style="display: flex; align-items: flex-start; gap: 8px; cursor: pointer; padding: 12px; background: var(--bg); border-radius: var(--radius); border: 2px solid var(--border); transition: all var(--transition);" class="review-option">
                                    <input type="radio" name="reviewInterval" value="option2" style="width: auto; cursor: pointer; margin-top: 4px;" />
                                    <div>
                                        <strong>Op√ß√£o 2:</strong> 24 horas, 3 dias, 7 dias, 30 dias, 90 dias
                                        <div style="font-size: 0.875rem; color: var(--text-secondary); margin-top: 4px;">Revis√µes mais frequentes no in√≠cio para melhor fixa√ß√£o</div>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary btn-full" id="studySessionSubmitBtn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12 6 12 12 16 14"></polyline>
                        </svg>
                        <span id="studySessionSubmitText">Registrar Sess√£o</span>
                    </button>
                </form>

                <div id="studySessionsList" class="mt-4"></div>
            </div>
        </div>

        <!-- Review Screen -->
        <div id="review" class="screen">
            <div class="card">
                <h2>Revis√µes Espa√ßadas</h2>
                <p style="margin-bottom: 24px; color: var(--text-secondary);">
                    Sistema de revis√µes espa√ßadas: 24 horas, 7 dias, 30 dias e 30 dias
                </p>
                <div id="reviewList"></div>
            </div>
        </div>

        <!-- Stats Screen -->
        <div id="stats" class="screen">
            <div class="stats-container">
                <div class="stat-box">
                    <h4>Total de Conte√∫dos</h4>
                    <div class="value" id="statTotal">0</div>
                </div>
                <div class="stat-box">
                    <h4>Completados</h4>
                    <div class="value" id="statCompleted">0</div>
                </div>
                <div class="stat-box">
                    <h4>Taxa de Conclus√£o</h4>
                    <div class="value" id="statRate">0%</div>
                </div>
                <div class="stat-box">
                    <h4>Tempo Total</h4>
                    <div class="value" id="statTime">0h</div>
                </div>
            </div>

            <div class="chart-container">
                <h3>Horas Estudadas por Per√≠odo</h3>
                <div class="stats-container">
                    <div class="stat-box">
                        <h4>Hoje</h4>
                        <div class="value" id="statToday">0h</div>
                    </div>
                    <div class="stat-box">
                        <h4>Semanal</h4>
                        <div class="value" id="statWeekly">0h</div>
                    </div>
                    <div class="stat-box">
                        <h4>Mensal</h4>
                        <div class="value" id="statMonthly">0h</div>
                    </div>
                    <div class="stat-box">
                        <h4>Semestral</h4>
                        <div class="value" id="statSemester">0h</div>
                    </div>
                    <div class="stat-box">
                        <h4>Anual</h4>
                        <div class="value" id="statYearly">0h</div>
                    </div>
                </div>
            </div>

            <div class="chart-container">
                <h3>Top 3 Mat√©rias Mais Estudadas</h3>
                <div id="topSubjectsRanking" class="ranking-container"></div>
            </div>

            <div class="chart-container">
                <h3>Conte√∫dos por Disciplina</h3>
                <div class="simple-bar" id="chartContainer"></div>
            </div>

            <div class="chart-container">
                <h3>Progresso por Dificuldade</h3>
                <div class="simple-bar" id="difficultyChart"></div>
            </div>
        </div>

        <!-- Pomodoro Screen -->
        <div id="pomodoro" class="screen">
            <div class="card">
                <h2>T√©cnica Pomodoro</h2>
                <p style="color: var(--text-secondary); margin-bottom: 24px;">
                    Melhore seu foco com a t√©cnica Pomodoro: per√≠odos de estudo intenso intercalados com pausas estrat√©gicas.
                </p>

                <div class="form-group">
                    <label for="pomodoroSubject">Mat√©ria *</label>
                    <select id="pomodoroSubject" required>
                        <option value="">Selecione uma mat√©ria</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="pomodoroContent">Conte√∫do *</label>
                    <select id="pomodoroContent" required>
                        <option value="">Selecione um conte√∫do</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>N√≠vel de Estudo</label>
                    <div class="pomodoro-levels">
                        <button class="level-btn active" data-level="beginner">
                            <div class="level-icon">üå±</div>
                            <div class="level-name">Iniciante</div>
                            <div class="level-time">25 min</div>
                            <div class="level-break">5 min descanso</div>
                        </button>
                        <button class="level-btn" data-level="intermediate">
                            <div class="level-icon">üåø</div>
                            <div class="level-name">Intermedi√°rio</div>
                            <div class="level-time">30 min</div>
                            <div class="level-break">5 min descanso</div>
                        </button>
                        <button class="level-btn" data-level="advanced">
                            <div class="level-icon">üå≥</div>
                            <div class="level-name">Avan√ßado</div>
                            <div class="level-time">45 min</div>
                            <div class="level-break">10 min descanso</div>
                        </button>
                        <button class="level-btn" data-level="expert">
                            <div class="level-icon">üöÄ</div>
                            <div class="level-name">Super Avan√ßado</div>
                            <div class="level-time">60 min</div>
                            <div class="level-break">15 min descanso</div>
                        </button>
                    </div>
                </div>

                <div class="pomodoro-timer-container">
                    <div class="pomodoro-display">
                        <div class="timer-type" id="timerType">Foco</div>
                        <div class="timer-display" id="timerDisplay">25:00</div>
                        <div class="session-info" id="sessionInfo">Sess√£o 1 de 4</div>
                    </div>

                    <div class="pomodoro-controls">
                        <button class="btn btn-primary" id="startPomodoroBtn">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="5 3 19 12 5 21 5 3"></polygon>
                            </svg>
                            Iniciar
                        </button>
                        <button class="btn btn-secondary" id="pausePomodoroBtn" style="display: none;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="6" y="4" width="4" height="16"></rect>
                                <rect x="14" y="4" width="4" height="16"></rect>
                            </svg>
                            Pausar
                        </button>
                        <button class="btn btn-secondary" id="resumePomodoroBtn" style="display: none;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="5 3 19 12 5 21 5 3"></polygon>
                            </svg>
                            Continuar
                        </button>
                        <button class="btn btn-danger" id="resetPomodoroBtn">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="1 4 1 10 7 10"></polyline>
                                <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
                            </svg>
                            Reiniciar
                        </button>
                    </div>

                    <div class="pomodoro-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="pomodoroProgress"></div>
                        </div>
                    </div>
                </div>

                <div class="pomodoro-history" id="pomodoroHistory">
                    <h3>Hist√≥rico de Hoje</h3>
                    <div id="todayPomodoroList"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Pomodoro Confirmation Modal -->
    <div class="pomodoro-modal-overlay" id="pomodoroModal">
        <div class="pomodoro-modal">
            <div class="pomodoro-modal-icon" id="pomodoroModalIcon">‚úÖ</div>
            <div class="pomodoro-modal-title" id="pomodoroModalTitle">Sess√£o Completa!</div>
            <div class="pomodoro-modal-message" id="pomodoroModalMessage">
                Parab√©ns! Voc√™ completou uma sess√£o de estudo.<br>
                Deseja fazer mais uma sess√£o?
            </div>
            <div class="pomodoro-modal-buttons">
                <button class="pomodoro-modal-btn pomodoro-modal-btn-primary" id="pomodoroModalContinue">
                    <span>üí™</span>
                    <span>Continuar</span>
                </button>
                <button class="pomodoro-modal-btn pomodoro-modal-btn-secondary" id="pomodoroModalStop">
                    <span>üéâ</span>
                    <span>Finalizar</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Pomodoro Association Modal -->
    <div class="pomodoro-modal-overlay" id="pomodoroAssociationModal">
        <div class="pomodoro-modal">
            <div class="pomodoro-modal-icon">‚è±Ô∏è</div>
            <div class="pomodoro-modal-title">Vincular ao Pomodoro?</div>
            <div class="pomodoro-modal-message">
                Deseja associar esta sess√£o de estudo √† t√©cnica Pomodoro?<br>
                <small style="opacity: 0.8; font-size: 0.9em;">O Pomodoro ser√° preenchido automaticamente com os dados da sua sess√£o.</small>
            </div>
            <div class="pomodoro-modal-buttons">
                <button class="pomodoro-modal-btn pomodoro-modal-btn-primary" id="pomodoroAssociationYes">
                    <span>‚úÖ</span>
                    <span>Sim, vincular</span>
                </button>
                <button class="pomodoro-modal-btn pomodoro-modal-btn-secondary" id="pomodoroAssociationNo">
                    <span>‚ùå</span>
                    <span>N√£o, obrigado</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        /**
         * Modern Study Planner Application
         * Built with ES6+ JavaScript, using class-based architecture
         */

        class StudyPlannerApp {
            constructor() {
                this.data = {
                    profile: {
                        name: '',
                        school: '',
                        course: '',
                        period: ''
                    },
                    subjects: [],
                    contents: [],
                    studySessions: [],
                    reviews: [],
                    settings: {
                        theme: 'light'
                    }
                };
                this.currentFilter = 'all';
                this.searchQuery = '';
                this.modalCallback = null;
                this.tempPomodoroData = null; // Temporary storage for Pomodoro association
                this.currentWeekOffset = 0; // 0 = current week, -1 = previous week, 1 = next week

                this.init();
            }

            /**
             * Initialize the application
             */
            init() {
                this.loadData();
                this.setupEventListeners();
                this.loadTheme();

                // Se o perfil n√£o estiver configurado, iniciar na aba Profile
                if (!this.data.profile || !this.data.profile.name) {
                    this.switchTab('profile');
                }

                this.render();
                this.showWelcomeMessage();
            }

            /**
             * Convert date string to local Date object
             * Fixes timezone issues when creating dates from YYYY-MM-DD format
             */
            getLocalDate(dateString) {
                const [year, month, day] = dateString.split('-').map(Number);
                return new Date(year, month - 1, day);
            }

            /**
             * Convert Date object to YYYY-MM-DD string in local timezone
             */
            formatDateLocal(date) {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            }

            /**
             * Setup all event listeners
             */
            setupEventListeners() {
                // Tab switching
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => this.switchTab(e.target.dataset.tab));
                });

                // Form submissions
                document.getElementById('profileForm').addEventListener('submit', (e) => this.handleProfileSubmit(e));
                document.getElementById('contentForm').addEventListener('submit', (e) => this.handleAddContent(e));
                document.getElementById('studySessionForm').addEventListener('submit', (e) => this.handleStudySession(e));

                // Search input
                document.getElementById('searchInput').addEventListener('input', (e) => {
                    this.searchQuery = e.target.value.toLowerCase();
                    this.renderContents();
                });

                // Filter tags
                document.querySelectorAll('.filter-tag').forEach(tag => {
                    tag.addEventListener('click', (e) => {
                        document.querySelectorAll('.filter-tag').forEach(t => t.classList.remove('active'));
                        e.target.classList.add('active');
                        this.currentFilter = e.target.dataset.filter;
                        this.renderContents();
                    });
                });

                // Modal
                document.getElementById('modalCancel').addEventListener('click', () => this.hideModal());
                document.getElementById('modalOverlay').addEventListener('click', (e) => {
                    if (e.target === document.getElementById('modalOverlay')) {
                        this.hideModal();
                    }
                });

                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        this.hideModal();
                    }
                });

                // Enter key on subject input
                document.getElementById('newSubject').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        this.addSubject();
                    }
                });

                // Pomodoro subject change
                document.getElementById('pomodoroSubject').addEventListener('change', (e) => {
                    this.updatePomodoroSelects(e.target.value);
                });

                // Pomodoro association modal
                document.getElementById('pomodoroAssociationYes').addEventListener('click', () => {
                    this.associateWithPomodoro();
                });
                document.getElementById('pomodoroAssociationNo').addEventListener('click', () => {
                    this.closePomodoroAssociationModal();
                });

                // Set today's date by default
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('studyDate').value = today;

                // Toggle spaced review options
                document.getElementById('enableSpacedReview').addEventListener('change', (e) => {
                    const options = document.getElementById('spacedReviewOptions');
                    options.style.display = e.target.checked ? 'block' : 'none';
                });
            }

            /**
             * Load data from localStorage
             */
            loadData() {
                try {
                    const saved = localStorage.getItem('studyPlannerData');
                    if (saved) {
                        const loadedData = JSON.parse(saved);
                        // Garantir que todas as propriedades necess√°rias existam
                        this.data = {
                            profile: loadedData.profile || {
                                name: '',
                                school: '',
                                course: '',
                                period: ''
                            },
                            subjects: loadedData.subjects || [],
                            contents: loadedData.contents || [],
                            studySessions: loadedData.studySessions || [],
                            reviews: loadedData.reviews || [],
                            settings: loadedData.settings || { theme: 'light' }
                        };
                    } else {
                        // Initial sample data
                        this.data = {
                            profile: {
                                name: '',
                                school: '',
                                course: '',
                                period: ''
                            },
                            subjects: ['Matem√°tica', 'Portugu√™s', 'Hist√≥ria', 'Biologia'],
                            contents: [
                                {
                                    id: Date.now(),
                                    subject: 'Matem√°tica',
                                    title: 'Equa√ß√µes do 2¬∫ Grau',
                                    difficulty: 'medium',
                                    completed: false,
                                    createdAt: new Date().toISOString()
                                },
                                {
                                    id: Date.now() + 1,
                                    subject: 'Portugu√™s',
                                    title: 'An√°lise Sint√°tica',
                                    difficulty: 'hard',
                                    completed: false,
                                    createdAt: new Date().toISOString()
                                }
                            ],
                            studySessions: [],
                            reviews: [],
                            settings: {
                                theme: 'light'
                            }
                        };
                        this.saveData();
                    }
                } catch (error) {
                    console.error('Error loading data:', error);
                    this.showToast('Erro ao carregar dados', 'error');
                }
            }

            /**
             * Save data to localStorage
             */
            saveData() {
                try {
                    localStorage.setItem('studyPlannerData', JSON.stringify(this.data));
                } catch (error) {
                    console.error('Error saving data:', error);
                    this.showToast('Erro ao salvar dados', 'error');
                }
            }

            /**
             * Add a new subject
             */
            addSubject() {
                const input = document.getElementById('newSubject');
                const subject = input.value.trim();

                if (!subject) {
                    this.showToast('Digite um nome para a disciplina', 'warning');
                    return;
                }

                if (this.data.subjects.includes(subject)) {
                    this.showToast('Esta disciplina j√° existe', 'warning');
                    return;
                }

                this.data.subjects.push(subject);
                input.value = '';
                this.saveData();
                this.render();
                this.showToast(`Disciplina "${subject}" adicionada com sucesso!`, 'success');
            }

            /**
             * Remove a subject
             */
            removeSubject(subject) {
                const contentsCount = this.data.contents.filter(c => c.subject === subject).length;
                const message = contentsCount > 0
                    ? `Remover "${subject}" e seus ${contentsCount} conte√∫do(s)?`
                    : `Remover a disciplina "${subject}"?`;

                this.showModal('Confirmar Remo√ß√£o', message, () => {
                    this.data.subjects = this.data.subjects.filter(s => s !== subject);
                    this.data.contents = this.data.contents.filter(c => c.subject !== subject);
                    this.saveData();
                    this.render();
                    this.showToast(`Disciplina "${subject}" removida`, 'success');
                });
            }

            /**
             * Handle profile form submission
             */
            handleProfileSubmit(e) {
                e.preventDefault();

                this.data.profile.name = document.getElementById('profileName').value.trim();
                this.data.profile.school = document.getElementById('profileSchool').value.trim();
                this.data.profile.course = document.getElementById('profileCourse').value.trim();
                this.data.profile.period = document.getElementById('profilePeriod').value.trim();

                this.saveData();
                this.renderProfile();
                this.showToast('Perfil salvo com sucesso!', 'success');

                // Ap√≥s salvar o perfil pela primeira vez, redirecionar para Dashboard
                this.switchTab('dashboard');
            }

            /**
             * Handle study session form submission
             */
            handleStudySession(e) {
                e.preventDefault();

                const editingSessionId = document.getElementById('editingSessionId').value;
                const contentId = parseInt(document.getElementById('studyContent').value);
                const date = document.getElementById('studyDate').value;
                const startTime = document.getElementById('studyStartTime').value;
                const endTime = document.getElementById('studyEndTime').value;

                if (!contentId) {
                    this.showToast('Selecione um conte√∫do', 'warning');
                    return;
                }

                const content = this.data.contents.find(c => c.id === contentId);
                if (!content) {
                    this.showToast('Conte√∫do n√£o encontrado', 'error');
                    return;
                }

                // Calculate duration
                const start = new Date(`${date}T${startTime}`);
                const end = new Date(`${date}T${endTime}`);
                const durationMinutes = Math.round((end - start) / 1000 / 60);

                if (durationMinutes <= 0) {
                    this.showToast('Hora de t√©rmino deve ser ap√≥s hora de in√≠cio', 'warning');
                    return;
                }

                // Check if we're editing an existing session
                if (editingSessionId) {
                    const sessionIndex = this.data.studySessions.findIndex(s => s.id === parseInt(editingSessionId));
                    if (sessionIndex !== -1) {
                        // Update existing session
                        this.data.studySessions[sessionIndex] = {
                            ...this.data.studySessions[sessionIndex],
                            contentId,
                            contentTitle: content.title,
                            subject: content.subject,
                            date,
                            startTime,
                            endTime,
                            duration: durationMinutes
                        };
                        this.showToast(`Sess√£o atualizada com sucesso!`, 'success');
                    }
                } else {
                    // Create new session
                    const session = {
                        id: Date.now(),
                        contentId,
                        contentTitle: content.title,
                        subject: content.subject,
                        date,
                        startTime,
                        endTime,
                        duration: durationMinutes,
                        createdAt: new Date().toISOString()
                    };

                    this.data.studySessions.push(session);

                    // Create spaced repetition schedule if enabled
                    const enableReview = document.getElementById('enableSpacedReview').checked;
                    if (enableReview) {
                        const reviewOption = document.querySelector('input[name="reviewInterval"]:checked').value;
                        this.createReviewSchedule(contentId, date, reviewOption);
                    }

                    this.showToast(`Sess√£o de ${durationMinutes} minutos registrada!`, 'success');

                    // Show Pomodoro association modal for new sessions
                    setTimeout(() => {
                        this.showPomodoroAssociationModal(content.subject, content.title);
                    }, 500);
                }

                // Reset form
                e.target.reset();
                document.getElementById('editingSessionId').value = '';
                document.getElementById('studySessionSubmitText').textContent = 'Registrar Sess√£o';
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('studyDate').value = today;
                document.getElementById('spacedReviewOptions').style.display = 'none';

                this.saveData();
                this.render();
            }

            /**
             * Edit a study session
             */
            editStudySession(sessionId) {
                const session = this.data.studySessions.find(s => s.id === sessionId);
                if (!session) {
                    this.showToast('Sess√£o n√£o encontrada', 'error');
                    return;
                }

                // Fill the form with session data
                document.getElementById('editingSessionId').value = sessionId;
                document.getElementById('studyContent').value = session.contentId;
                document.getElementById('studyDate').value = session.date;
                document.getElementById('studyStartTime').value = session.startTime;
                document.getElementById('studyEndTime').value = session.endTime;

                // Update button text
                document.getElementById('studySessionSubmitText').textContent = 'Atualizar Sess√£o';

                // Scroll to form
                document.getElementById('studySessionForm').scrollIntoView({ behavior: 'smooth', block: 'start' });

                this.showToast('Editando sess√£o de estudo', 'info');
            }

            /**
             * Remove a study session
             */
            removeStudySession(sessionId) {
                const session = this.data.studySessions.find(s => s.id === sessionId);
                if (!session) {
                    this.showToast('Sess√£o n√£o encontrada', 'error');
                    return;
                }

                this.showModal(
                    'Confirmar Exclus√£o',
                    `Deseja realmente excluir a sess√£o de estudo "${session.contentTitle}"?`,
                    () => {
                        this.data.studySessions = this.data.studySessions.filter(s => s.id !== sessionId);
                        this.saveData();
                        this.renderStudySessions();
                        this.renderStats();
                        this.showToast('Sess√£o de estudo exclu√≠da com sucesso!', 'success');
                    }
                );
            }

            /**
             * Create spaced repetition schedule
             */
            createReviewSchedule(contentId, studyDate, reviewOption = 'option1') {
                const content = this.data.contents.find(c => c.id === contentId);
                if (!content) return;

                const baseDate = this.getLocalDate(studyDate);

                // Define intervals based on selected option
                // option1: 24 horas, 7 dias, 30 dias, 90 dias
                // option2: 24 horas, 3 dias, 7 dias, 30 dias, 90 dias
                const intervals = reviewOption === 'option1'
                    ? [1, 7, 30, 90]
                    : [1, 3, 7, 30, 90];

                intervals.forEach((days, index) => {
                    const reviewDate = new Date(baseDate);
                    reviewDate.setDate(reviewDate.getDate() + days);

                    const existingReview = this.data.reviews.find(r =>
                        r.contentId === contentId &&
                        r.reviewNumber === index + 1 &&
                        r.scheduledDate === this.formatDateLocal(reviewDate)
                    );

                    if (!existingReview) {
                        this.data.reviews.push({
                            id: Date.now() + index,
                            contentId,
                            contentTitle: content.title,
                            subject: content.subject,
                            reviewNumber: index + 1,
                            scheduledDate: this.formatDateLocal(reviewDate),
                            completed: false,
                            type: null,
                            completedAt: null
                        });
                    }
                });
            }

            /**
             * Complete a review
             */
            completeReview(reviewId, type) {
                const review = this.data.reviews.find(r => r.id === reviewId);
                if (!review) return;

                review.completed = true;
                review.type = type;
                review.completedAt = new Date().toISOString();

                this.saveData();
                this.renderReview();
                this.showToast(`Revis√£o registrada como ${type}!`, 'success');
            }

            /**
             * Handle add content form submission
             */
            handleAddContent(e) {
                e.preventDefault();

                const subject = document.getElementById('contentSubject').value;
                const title = document.getElementById('contentTitle').value.trim();
                const difficulty = document.getElementById('contentDifficulty').value;

                if (!subject) {
                    this.showToast('Selecione uma disciplina', 'warning');
                    return;
                }

                if (!title) {
                    this.showToast('Digite um t√≠tulo', 'warning');
                    return;
                }

                const newContent = {
                    id: Date.now(),
                    subject,
                    title,
                    difficulty,
                    completed: false,
                    createdAt: new Date().toISOString()
                };

                this.data.contents.push(newContent);
                e.target.reset();
                this.saveData();
                this.render();
                this.switchTab('dashboard');
                this.showToast(`Conte√∫do "${title}" adicionado com sucesso!`, 'success');
            }

            /**
             * Toggle content completion
             */
            toggleComplete(id) {
                const content = this.data.contents.find(c => c.id === id);
                if (content) {
                    content.completed = !content.completed;
                    this.saveData();
                    this.render();

                    const message = content.completed
                        ? `"${content.title}" marcado como completo!`
                        : `"${content.title}" desmarcado`;
                    this.showToast(message, 'success');
                }
            }

            /**
             * Remove a content
             */
            removeContent(id) {
                const content = this.data.contents.find(c => c.id === id);
                if (!content) return;

                this.showModal('Confirmar Remo√ß√£o', `Remover o conte√∫do "${content.title}"?`, () => {
                    this.data.contents = this.data.contents.filter(c => c.id !== id);
                    this.saveData();
                    this.render();
                    this.showToast('Conte√∫do removido', 'success');
                });
            }

            /**
             * Switch between tabs
             */
            switchTab(tabName) {
                // Update tab buttons
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    const isActive = btn.dataset.tab === tabName;
                    btn.classList.toggle('active', isActive);
                    btn.setAttribute('aria-selected', isActive);
                });

                // Update screens
                document.querySelectorAll('.screen').forEach(screen => {
                    screen.classList.toggle('active', screen.id === tabName);
                });

                // Render specific tab content
                if (tabName === 'stats') {
                    this.renderStats();
                } else if (tabName === 'study') {
                    this.renderStudySessions();
                    this.updateSelects();
                } else if (tabName === 'review') {
                    this.renderReview();
                } else if (tabName === 'profile') {
                    this.renderProfile();
                }
            }

            /**
             * Filter contents based on search and filters
             */
            getFilteredContents() {
                let filtered = [...this.data.contents];

                // Apply search filter
                if (this.searchQuery) {
                    filtered = filtered.filter(c =>
                        c.title.toLowerCase().includes(this.searchQuery) ||
                        c.desc.toLowerCase().includes(this.searchQuery) ||
                        c.subject.toLowerCase().includes(this.searchQuery)
                    );
                }

                // Apply category filter
                if (this.currentFilter !== 'all') {
                    switch (this.currentFilter) {
                        case 'pending':
                            filtered = filtered.filter(c => !c.completed);
                            break;
                        case 'completed':
                            filtered = filtered.filter(c => c.completed);
                            break;
                        case 'easy':
                        case 'medium':
                        case 'hard':
                            filtered = filtered.filter(c => c.difficulty === this.currentFilter);
                            break;
                    }
                }

                return filtered;
            }

            /**
             * Render all components
             */
            render() {
                this.renderProfile();
                this.renderSubjects();
                this.renderContents();
                this.renderReview();
                this.renderStudySessions();
                this.renderWeeklyAgenda();
                this.updateSelects();
                this.updateHeaderStats();
            }

            /**
             * Render profile
             */
            renderProfile() {
                const profile = this.data.profile;
                const display = document.getElementById('profileDisplay');

                if (profile && profile.name) {
                    document.getElementById('profileName').value = profile.name;
                    document.getElementById('profileSchool').value = profile.school;
                    document.getElementById('profileCourse').value = profile.course;
                    document.getElementById('profilePeriod').value = profile.period;

                    document.getElementById('displayName').textContent = profile.name;
                    document.getElementById('displaySchool').textContent = profile.school;
                    document.getElementById('displayCourse').textContent = profile.course;
                    document.getElementById('displayPeriod').textContent = profile.period;

                    // Atualizar header com nome e curso
                    document.getElementById('headerUserName').textContent = profile.name;
                    document.getElementById('headerUserCourse').textContent = profile.course;
                    document.getElementById('headerUserInfo').style.display = 'block';

                    display.style.display = 'block';
                } else {
                    display.style.display = 'none';
                    document.getElementById('headerUserInfo').style.display = 'none';
                }
            }

            /**
             * Render study sessions
             */
            renderStudySessions() {
                const list = document.getElementById('studySessionsList');

                if (this.data.studySessions.length === 0) {
                    list.innerHTML = '<p style="text-align: center; color: var(--text-secondary); margin-top: 24px;">Nenhuma sess√£o registrada ainda</p>';
                    return;
                }

                const sessions = [...this.data.studySessions].reverse();

                list.innerHTML = `
                    <h3 style="margin-top: 24px; margin-bottom: 16px;">Hist√≥rico de Sess√µes</h3>
                    ${sessions.map(session => `
                        <div class="content-item" style="margin-bottom: 16px;">
                            <div class="content-header">
                                <div style="flex: 1;">
                                    <h4 class="content-title" style="font-size: 1.1rem;">${this.escapeHtml(session.contentTitle)}</h4>
                                    <div class="badges">
                                        <span class="badge badge-subject">${this.escapeHtml(session.subject)}</span>
                                        <span class="badge badge-time">${session.duration} min</span>
                                    </div>
                                </div>
                            </div>
                            <p style="color: var(--text-secondary); margin-top: 12px;">
                                <strong>Data:</strong> ${this.getLocalDate(session.date).toLocaleDateString('pt-BR')}<br>
                                <strong>Hor√°rio:</strong> ${session.startTime} - ${session.endTime}
                            </p>
                            <div style="display: flex; gap: 8px; margin-top: 16px; flex-wrap: wrap;">
                                <button
                                    class="btn btn-secondary btn-small"
                                    onclick="window.app.editStudySession(${session.id})"
                                >
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                    </svg>
                                    Editar
                                </button>
                                <button
                                    class="btn btn-danger btn-small"
                                    onclick="window.app.removeStudySession(${session.id})"
                                >
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="3 6 5 6 21 6"></polyline>
                                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                    </svg>
                                    Excluir
                                </button>
                            </div>
                        </div>
                    `).join('')}
                `;
            }

            /**
             * Render subjects list
             */
            renderSubjects() {
                const list = document.getElementById('subjectsList');

                if (this.data.subjects.length === 0) {
                    list.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 20px 0;">Nenhuma disciplina cadastrada</p>';
                    return;
                }

                list.innerHTML = this.data.subjects.map(subject => {
                    const count = this.data.contents.filter(c => c.subject === subject).length;
                    return `
                        <div class="subject-item">
                            <span>${subject} ${count > 0 ? `(${count})` : ''}</span>
                            <button
                                class="subject-item-delete"
                                onclick="app.removeSubject('${subject.replace(/'/g, "\\'")}')"
                                aria-label="Remover ${subject}"
                            >
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="18" y1="6" x2="6" y2="18"></line>
                                    <line x1="6" y1="6" x2="18" y2="18"></line>
                                </svg>
                            </button>
                        </div>
                    `;
                }).join('');
            }

            /**
             * Render contents list
             */
            renderContents() {
                const list = document.getElementById('contentList');
                const empty = document.getElementById('emptyState');
                const filtered = this.getFilteredContents();

                if (filtered.length === 0) {
                    list.innerHTML = '';
                    empty.style.display = 'block';
                    return;
                }

                empty.style.display = 'none';

                const difficultyLabels = {
                    easy: 'F√°cil',
                    medium: 'M√©dio',
                    hard: 'Dif√≠cil'
                };

                list.innerHTML = filtered.map(content => `
                    <article class="content-item">
                        <div class="content-header">
                            <div style="flex: 1;">
                                <h3 class="content-title">${this.escapeHtml(content.title)}</h3>
                                <div class="badges">
                                    <span class="badge badge-subject">
                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                                            <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                                        </svg>
                                        ${this.escapeHtml(content.subject)}
                                    </span>
                                    <span class="badge badge-difficulty-${content.difficulty}">
                                        ${difficultyLabels[content.difficulty]}
                                    </span>
                                </div>
                            </div>
                            <div class="checkbox-wrapper">
                                <input
                                    type="checkbox"
                                    ${content.completed ? 'checked' : ''}
                                    onchange="app.toggleComplete(${content.id})"
                                    aria-label="Marcar como ${content.completed ? 'n√£o completo' : 'completo'}"
                                />
                            </div>
                        </div>
                        <div class="content-actions">
                            <button
                                class="btn ${content.completed ? 'btn-secondary' : 'btn-success'} btn-small"
                                onclick="app.toggleComplete(${content.id})"
                            >
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    ${content.completed
                                        ? '<polyline points="1 12 7 18 23 2"></polyline>'
                                        : '<circle cx="12" cy="12" r="10"></circle>'}
                                </svg>
                                ${content.completed ? 'Completo' : 'Marcar Completo'}
                            </button>
                            <button
                                class="btn btn-danger btn-small"
                                onclick="app.removeContent(${content.id})"
                            >
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="3 6 5 6 21 6"></polyline>
                                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                </svg>
                                Remover
                            </button>
                        </div>
                    </article>
                `).join('');
            }

            /**
             * Render review list
             */
            renderReview() {
                const list = document.getElementById('reviewList');

                if (this.data.reviews.length === 0) {
                    list.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">üìÖ</div>
                            <p>Nenhuma revis√£o agendada</p>
                            <p>Registre uma sess√£o de estudo para criar revis√µes espa√ßadas autom√°ticas</p>
                        </div>
                    `;
                    return;
                }

                const today = new Date().toISOString().split('T')[0];

                // Dynamic review labels based on the actual schedule
                const reviewLabels = {};
                this.data.reviews.forEach(review => {
                    if (!reviewLabels[review.reviewNumber]) {
                        // Calculate days from first session
                        const firstSession = this.data.studySessions.find(s => s.contentId === review.contentId);
                        if (firstSession) {
                            const baseDate = this.getLocalDate(firstSession.date);
                            const reviewDate = this.getLocalDate(review.scheduledDate);
                            const days = Math.round((reviewDate - baseDate) / (1000 * 60 * 60 * 24));
                            reviewLabels[review.reviewNumber] = days === 1 ? '24 horas' : `${days} dias`;
                        }
                    }
                });

                // Fallback labels if calculation fails
                if (Object.keys(reviewLabels).length === 0) {
                    reviewLabels[1] = '24 horas';
                    reviewLabels[2] = '3-7 dias';
                    reviewLabels[3] = '7-30 dias';
                    reviewLabels[4] = '30 dias';
                    reviewLabels[5] = '90 dias';
                }

                const typeLabels = {
                    flashcard: 'Flashcard',
                    simulado: 'Simulado',
                    outro: 'Outro'
                };

                // Group reviews
                const pending = this.data.reviews.filter(r => !r.completed && r.scheduledDate <= today);
                const upcoming = this.data.reviews.filter(r => !r.completed && r.scheduledDate > today);
                const completed = this.data.reviews.filter(r => r.completed);

                let html = '';

                if (pending.length > 0) {
                    html += `<h3 style="margin-bottom: 16px; color: var(--danger);">‚ö†Ô∏è Revis√µes Pendentes</h3>`;
                    html += pending.map(review => this.renderReviewItem(review, reviewLabels, typeLabels, true)).join('');
                }

                if (upcoming.length > 0) {
                    html += `<h3 style="margin-top: 32px; margin-bottom: 16px;">üìÖ Pr√≥ximas Revis√µes</h3>`;
                    html += upcoming.map(review => this.renderReviewItem(review, reviewLabels, typeLabels, false)).join('');
                }

                if (completed.length > 0) {
                    html += `<h3 style="margin-top: 32px; margin-bottom: 16px;">‚úì Revis√µes Conclu√≠das</h3>`;
                    html += completed.map(review => this.renderCompletedReviewItem(review, reviewLabels, typeLabels)).join('');
                }

                list.innerHTML = html;
            }

            /**
             * Render a single review item
             */
            renderReviewItem(review, reviewLabels, typeLabels, isPending) {
                const date = this.getLocalDate(review.scheduledDate);
                const dateStr = date.toLocaleDateString('pt-BR');

                return `
                    <article class="content-item" style="border-left-color: ${isPending ? 'var(--danger)' : 'var(--primary)'}">
                        <div class="content-header">
                            <div style="flex: 1;">
                                <h3 class="content-title">${this.escapeHtml(review.contentTitle)}</h3>
                                <div class="badges">
                                    <span class="badge badge-subject">${this.escapeHtml(review.subject)}</span>
                                    <span class="badge" style="background: rgba(124, 58, 237, 0.1); color: var(--secondary); border: 1px solid rgba(124, 58, 237, 0.2);">
                                        Revis√£o ${review.reviewNumber} - ${reviewLabels[review.reviewNumber]}
                                    </span>
                                    <span class="badge badge-time">
                                        üìÖ ${dateStr}
                                    </span>
                                </div>
                            </div>
                        </div>
                        <p style="color: var(--text-secondary); margin: 12px 0;">
                            Escolha o m√©todo de revis√£o:
                        </p>
                        <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                            <button
                                class="btn btn-success btn-small"
                                onclick="app.completeReview(${review.id}, 'flashcard')"
                            >
                                üé¥ Flashcard
                            </button>
                            <button
                                class="btn btn-success btn-small"
                                onclick="app.completeReview(${review.id}, 'simulado')"
                            >
                                üìù Simulado
                            </button>
                            <button
                                class="btn btn-success btn-small"
                                onclick="app.completeReview(${review.id}, 'outro')"
                            >
                                üìö Outro
                            </button>
                        </div>
                    </article>
                `;
            }

            /**
             * Render a completed review item
             */
            renderCompletedReviewItem(review, reviewLabels, typeLabels) {
                const date = this.getLocalDate(review.scheduledDate);
                const dateStr = date.toLocaleDateString('pt-BR');
                const completedDate = new Date(review.completedAt);
                const completedStr = completedDate.toLocaleDateString('pt-BR');

                return `
                    <article class="content-item" style="border-left-color: var(--success); opacity: 0.8;">
                        <div class="content-header">
                            <div style="flex: 1;">
                                <h3 class="content-title">${this.escapeHtml(review.contentTitle)}</h3>
                                <div class="badges">
                                    <span class="badge badge-subject">${this.escapeHtml(review.subject)}</span>
                                    <span class="badge" style="background: rgba(124, 58, 237, 0.1); color: var(--secondary); border: 1px solid rgba(124, 58, 237, 0.2);">
                                        Revis√£o ${review.reviewNumber} - ${reviewLabels[review.reviewNumber]}
                                    </span>
                                    <span class="badge" style="background: rgba(16, 185, 129, 0.1); color: var(--success); border: 1px solid rgba(16, 185, 129, 0.2);">
                                        ‚úì ${typeLabels[review.type]}
                                    </span>
                                </div>
                            </div>
                        </div>
                        <p style="color: var(--text-secondary); margin-top: 12px; font-size: 0.9rem;">
                            <strong>Agendada para:</strong> ${dateStr} |
                            <strong>Conclu√≠da em:</strong> ${completedStr}
                        </p>
                    </article>
                `;
            }

            /**
             * Render statistics
             */
            renderStats() {
                const total = this.data.contents.length;
                const completed = this.data.contents.filter(c => c.completed).length;
                const rate = total > 0 ? Math.round((completed / total) * 100) : 0;

                // Calculate actual study time from sessions
                const totalStudyTime = this.data.studySessions.reduce((sum, s) => sum + s.duration, 0);
                const totalStudyHours = Math.round(totalStudyTime / 60);
                const totalStudyMinutes = totalStudyTime % 60;

                // Calculate total reviews
                const totalReviews = this.data.reviews.length;
                const completedReviews = this.data.reviews.filter(r => r.completed).length;

                document.getElementById('statTotal').textContent = total;
                document.getElementById('statCompleted').textContent = completed;
                document.getElementById('statRate').textContent = rate + '%';
                document.getElementById('statTime').textContent = totalStudyHours > 0
                    ? `${totalStudyHours}h ${totalStudyMinutes}min`
                    : `${totalStudyMinutes}min`;

                // Calculate study time by period
                const now = new Date();
                const startOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                const startOfWeek = new Date(now);
                startOfWeek.setDate(now.getDate() - now.getDay());
                startOfWeek.setHours(0, 0, 0, 0);
                const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);
                const startOfSemester = new Date(now.getFullYear(), Math.floor(now.getMonth() / 6) * 6, 1);
                const startOfYear = new Date(now.getFullYear(), 0, 1);

                const calculatePeriodTime = (startDate) => {
                    return this.data.studySessions
                        .filter(s => this.getLocalDate(s.date) >= startDate)
                        .reduce((sum, s) => sum + s.duration, 0);
                };

                const formatTime = (minutes) => {
                    const hours = Math.floor(minutes / 60);
                    const mins = minutes % 60;
                    if (hours > 0) {
                        return mins > 0 ? `${hours}h ${mins}min` : `${hours}h`;
                    }
                    return `${mins}min`;
                };

                document.getElementById('statToday').textContent = formatTime(calculatePeriodTime(startOfDay));
                document.getElementById('statWeekly').textContent = formatTime(calculatePeriodTime(startOfWeek));
                document.getElementById('statMonthly').textContent = formatTime(calculatePeriodTime(startOfMonth));
                document.getElementById('statSemester').textContent = formatTime(calculatePeriodTime(startOfSemester));
                document.getElementById('statYearly').textContent = formatTime(calculatePeriodTime(startOfYear));

                // Calculate top 3 most studied subjects
                const subjectStudyTime = {};
                this.data.studySessions.forEach(session => {
                    const content = this.data.contents.find(c => c.id === session.contentId);
                    if (content) {
                        const subject = content.subject;
                        if (!subjectStudyTime[subject]) {
                            subjectStudyTime[subject] = 0;
                        }
                        subjectStudyTime[subject] += session.duration;
                    }
                });

                const topSubjects = Object.entries(subjectStudyTime)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 3);

                const rankingContainer = document.getElementById('topSubjectsRanking');
                if (topSubjects.length === 0) {
                    rankingContainer.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 40px;">Nenhuma sess√£o de estudo registrada ainda</p>';
                } else {
                    const rankingClasses = ['first', 'second', 'third'];
                    const medals = ['üëë', 'ü•à', 'ü•â'];

                    rankingContainer.innerHTML = topSubjects.map(([subject, minutes], index) => {
                        const hours = Math.floor(minutes / 60);
                        const mins = minutes % 60;
                        const timeText = hours > 0
                            ? `${hours}h ${mins}min de estudo`
                            : `${mins}min de estudo`;

                        return `
                            <div class="ranking-item ${rankingClasses[index]}">
                                <div class="ranking-position">
                                    ${index === 0 ? '<span class="ranking-crown">üëë</span>' : medals[index]}
                                </div>
                                <div class="ranking-info">
                                    <div class="ranking-subject">${this.escapeHtml(subject)}</div>
                                    <div class="ranking-hours">${timeText}</div>
                                </div>
                                <div class="ranking-badge">#${index + 1}</div>
                            </div>
                        `;
                    }).join('');
                }

                // Subject distribution chart
                const subjectStats = {};
                this.data.contents.forEach(c => {
                    if (!subjectStats[c.subject]) subjectStats[c.subject] = 0;
                    subjectStats[c.subject]++;
                });

                const chartContainer = document.getElementById('chartContainer');
                if (Object.keys(subjectStats).length === 0) {
                    chartContainer.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 40px;">Nenhum dado dispon√≠vel</p>';
                } else {
                    const maxCount = Math.max(...Object.values(subjectStats));
                    chartContainer.innerHTML = Object.entries(subjectStats).map(([subject, count]) => {
                        const height = Math.max(30, (count / maxCount) * 200);
                        return `
                            <div class="bar-item">
                                <div class="bar-value">${count}</div>
                                <div class="bar" style="height: ${height}px;"></div>
                                <div class="bar-label">${this.escapeHtml(subject)}</div>
                            </div>
                        `;
                    }).join('');
                }

                // Difficulty distribution chart
                const difficultyStats = {
                    easy: this.data.contents.filter(c => c.difficulty === 'easy').length,
                    medium: this.data.contents.filter(c => c.difficulty === 'medium').length,
                    hard: this.data.contents.filter(c => c.difficulty === 'hard').length
                };

                const difficultyLabels = {
                    easy: 'F√°cil',
                    medium: 'M√©dio',
                    hard: 'Dif√≠cil'
                };

                const difficultyChart = document.getElementById('difficultyChart');
                const maxDifficulty = Math.max(...Object.values(difficultyStats), 1);
                difficultyChart.innerHTML = Object.entries(difficultyStats).map(([level, count]) => {
                    const height = Math.max(30, (count / maxDifficulty) * 200);
                    return `
                        <div class="bar-item">
                            <div class="bar-value">${count}</div>
                            <div class="bar" style="height: ${height}px;"></div>
                            <div class="bar-label">${difficultyLabels[level]}</div>
                        </div>
                    `;
                }).join('');
            }

            /**
             * Update subject select options
             */
            updateSelects() {
                const select = document.getElementById('contentSubject');
                select.innerHTML = '<option value="">Selecione uma disciplina</option>' +
                    this.data.subjects.map(s => `<option value="${this.escapeHtml(s)}">${this.escapeHtml(s)}</option>`).join('');

                const studySelect = document.getElementById('studyContent');
                studySelect.innerHTML = '<option value="">Selecione um conte√∫do</option>' +
                    this.data.contents.map(c => `<option value="${c.id}">${this.escapeHtml(c.subject)} - ${this.escapeHtml(c.title)}</option>`).join('');

                // Update Pomodoro selects
                this.updatePomodoroSelects();
            }

            /**
             * Update Pomodoro select options
             */
            updatePomodoroSelects(selectedSubject = null) {
                const subjectSelect = document.getElementById('pomodoroSubject');
                subjectSelect.innerHTML = '<option value="">Selecione uma mat√©ria</option>' +
                    this.data.subjects.map(s => `<option value="${this.escapeHtml(s)}">${this.escapeHtml(s)}</option>`).join('');

                // If a subject is pre-selected, set it
                if (selectedSubject) {
                    subjectSelect.value = selectedSubject;
                }

                // Update content select based on selected subject
                const contentSelect = document.getElementById('pomodoroContent');
                const currentSubject = selectedSubject || subjectSelect.value;

                if (currentSubject) {
                    const filteredContents = this.data.contents.filter(c => c.subject === currentSubject);
                    contentSelect.innerHTML = '<option value="">Selecione um conte√∫do</option>' +
                        filteredContents.map(c => `<option value="${this.escapeHtml(c.title)}">${this.escapeHtml(c.title)}</option>`).join('');
                } else {
                    contentSelect.innerHTML = '<option value="">Selecione uma mat√©ria primeiro</option>';
                }
            }

            /**
             * Update header stats
             */
            updateHeaderStats() {
                document.getElementById('headerSubjectCount').textContent = this.data.subjects.length;
                document.getElementById('headerContentCount').textContent = this.data.contents.length;
            }

            /**
             * Clear search input
             */
            clearSearch() {
                document.getElementById('searchInput').value = '';
                this.searchQuery = '';
                this.renderContents();
            }

            /**
             * Show toast notification
             */
            showToast(message, type = 'info') {
                const container = document.getElementById('toastContainer');
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;

                const icons = {
                    success: '‚úì',
                    error: '‚úï',
                    warning: '‚ö†',
                    info: '‚Ñπ'
                };

                toast.innerHTML = `
                    <div class="toast-icon">${icons[type] || icons.info}</div>
                    <div class="toast-content">
                        <div class="toast-message">${this.escapeHtml(message)}</div>
                    </div>
                    <button class="toast-close" onclick="this.parentElement.remove()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                `;

                container.appendChild(toast);

                // Auto remove after 4 seconds
                setTimeout(() => {
                    toast.style.animation = 'slideInRight 0.3s ease reverse';
                    setTimeout(() => toast.remove(), 300);
                }, 4000);
            }

            /**
             * Show modal
             */
            showModal(title, message, callback) {
                document.getElementById('modalTitle').textContent = title;
                document.getElementById('modalBody').textContent = message;
                document.getElementById('modalOverlay').classList.add('show');

                this.modalCallback = callback;

                const confirmBtn = document.getElementById('modalConfirm');
                const newConfirmBtn = confirmBtn.cloneNode(true);
                confirmBtn.parentNode.replaceChild(newConfirmBtn, confirmBtn);

                newConfirmBtn.addEventListener('click', () => {
                    if (this.modalCallback) {
                        this.modalCallback();
                        this.modalCallback = null;
                    }
                    this.hideModal();
                });
            }

            /**
             * Hide modal
             */
            hideModal() {
                document.getElementById('modalOverlay').classList.remove('show');
                this.modalCallback = null;
            }

            /**
             * Show Pomodoro association modal
             */
            showPomodoroAssociationModal(subject, contentTitle) {
                this.tempPomodoroData = { subject, contentTitle };
                const modal = document.getElementById('pomodoroAssociationModal');
                modal.classList.add('show');
            }

            /**
             * Close Pomodoro association modal
             */
            closePomodoroAssociationModal() {
                const modal = document.getElementById('pomodoroAssociationModal');
                modal.classList.remove('show');
                this.tempPomodoroData = null;
            }

            /**
             * Associate session with Pomodoro
             */
            associateWithPomodoro() {
                if (!this.tempPomodoroData) return;

                const { subject, contentTitle } = this.tempPomodoroData;

                // Close modal
                this.closePomodoroAssociationModal();

                // Switch to Pomodoro tab
                this.switchTab('pomodoro');

                // Pre-fill Pomodoro form
                setTimeout(() => {
                    const subjectSelect = document.getElementById('pomodoroSubject');
                    const contentSelect = document.getElementById('pomodoroContent');

                    // Set subject
                    subjectSelect.value = subject;

                    // Update content options and set content
                    this.updatePomodoroSelects(subject);

                    // Set content after a brief delay to ensure options are populated
                    setTimeout(() => {
                        contentSelect.value = contentTitle;
                    }, 50);

                    this.showToast('Pomodoro preenchido automaticamente! Clique em Iniciar quando estiver pronto.', 'success');
                }, 100);
            }

            /**
             * Toggle theme
             */
            toggleTheme() {
                const currentTheme = document.documentElement.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

                document.documentElement.setAttribute('data-theme', newTheme);
                this.data.settings.theme = newTheme;
                this.saveData();

                this.showToast(`Tema ${newTheme === 'dark' ? 'escuro' : 'claro'} ativado`, 'success');
            }

            /**
             * Load theme from settings
             */
            loadTheme() {
                const theme = this.data.settings?.theme || 'light';
                document.documentElement.setAttribute('data-theme', theme);
            }

            /**
             * Export data as JSON
             */
            exportData() {
                const dataStr = JSON.stringify(this.data, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `medlife-planner-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                URL.revokeObjectURL(url);

                this.showToast('Dados exportados com sucesso!', 'success');
            }

            /**
             * Show welcome message for first-time users
             */
            showWelcomeMessage() {
                const isFirstVisit = !localStorage.getItem('studyPlannerVisited');
                if (isFirstVisit) {
                    setTimeout(() => {
                        this.showToast('Bem-vindo ao Planejador de Estudos MedLife!', 'success');
                        localStorage.setItem('studyPlannerVisited', 'true');
                    }, 500);
                }
            }

            /**
             * Get week start (Monday) and end (Sunday) dates
             */
            getWeekDates(offset = 0) {
                const today = new Date();
                const currentDay = today.getDay();
                const diff = currentDay === 0 ? -6 : 1 - currentDay; // Adjust when Sunday (0)

                const monday = new Date(today);
                monday.setDate(today.getDate() + diff + (offset * 7));
                monday.setHours(0, 0, 0, 0);

                const days = [];
                for (let i = 0; i < 7; i++) {
                    const day = new Date(monday);
                    day.setDate(monday.getDate() + i);
                    days.push(day);
                }

                return days;
            }

            /**
             * Format date as YYYY-MM-DD
             */
            formatDateLocal(date) {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            }

            /**
             * Get reviews for a specific date
             */
            getReviewsForDate(dateString) {
                return this.data.reviews.filter(review => review.scheduledDate === dateString);
            }

            /**
             * Render weekly agenda
             */
            renderWeeklyAgenda() {
                const weekDays = this.getWeekDates(this.currentWeekOffset);
                const weekGrid = document.getElementById('weekGrid');
                const emptyState = document.getElementById('emptyWeekState');

                if (!weekGrid) return;

                const dayNames = ['Segunda', 'Ter√ßa', 'Quarta', 'Quinta', 'Sexta', 'S√°bado', 'Domingo'];
                const monthNames = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];

                // Update week title
                const firstDay = weekDays[0];
                const lastDay = weekDays[6];
                const weekRange = document.getElementById('weekRange');
                if (weekRange) {
                    weekRange.textContent = `${firstDay.getDate()} de ${monthNames[firstDay.getMonth()]} - ${lastDay.getDate()} de ${monthNames[lastDay.getMonth()]} ${lastDay.getFullYear()}`;
                }

                let totalReviews = 0;
                let html = '';

                const today = new Date();
                today.setHours(0, 0, 0, 0);

                weekDays.forEach((day, index) => {
                    const dateString = this.formatDateLocal(day);
                    const reviews = this.getReviewsForDate(dateString);
                    const pendingReviews = reviews.filter(r => !r.completed);
                    const completedReviews = reviews.filter(r => r.completed);

                    totalReviews += reviews.length;

                    const isToday = day.getTime() === today.getTime();
                    const todayClass = isToday ? 'today' : '';

                    html += `
                        <div class="day-column ${todayClass}">
                            <div class="day-header">
                                <div class="day-name">${dayNames[index]}</div>
                                <div class="day-date">${day.getDate()}</div>
                                <div class="day-month">${monthNames[day.getMonth()]}</div>
                            </div>
                            <div class="reviews-list">
                    `;

                    if (reviews.length === 0) {
                        html += `<div class="empty-day">Sem revis√µes</div>`;
                    } else {
                        // Render pending reviews first
                        pendingReviews.forEach(review => {
                            html += this.renderMiniReviewItem(review);
                        });

                        // Then completed reviews
                        completedReviews.forEach(review => {
                            html += this.renderMiniReviewItem(review);
                        });
                    }

                    html += `
                            </div>
                            ${reviews.length > 0 ? `
                                <div class="day-reviews-count">
                                    ${pendingReviews.length} pendente${pendingReviews.length !== 1 ? 's' : ''}
                                    ${completedReviews.length > 0 ? `‚Ä¢ ${completedReviews.length} conclu√≠da${completedReviews.length !== 1 ? 's' : ''}` : ''}
                                </div>
                            ` : ''}
                        </div>
                    `;
                });

                weekGrid.innerHTML = html;

                // Show/hide empty state
                if (emptyState) {
                    emptyState.style.display = totalReviews === 0 ? 'block' : 'none';
                }
            }

            /**
             * Render mini review item for weekly agenda
             */
            renderMiniReviewItem(review) {
                const completedClass = review.completed ? 'completed' : '';
                const intervals = this.getReviewOption() === '1' ? [1, 7, 30, 90] : [1, 3, 7, 30, 90];
                const intervalLabels = this.getReviewOption() === '1'
                    ? ['24 horas', '1 semana', '1 m√™s', '3 meses']
                    : ['24 horas', '3 dias', '1 semana', '1 m√™s', '3 meses'];

                const intervalLabel = intervalLabels[review.reviewNumber - 1] || `Revis√£o ${review.reviewNumber}`;

                return `
                    <div class="review-item-mini ${completedClass}">
                        <div class="review-mini-header">
                            <span class="review-number-badge">R${review.reviewNumber} - ${intervalLabel}</span>
                        </div>
                        <div class="review-mini-title" title="${this.escapeHtml(review.contentTitle)}">
                            ${this.escapeHtml(review.contentTitle)}
                        </div>
                        <div class="review-mini-subject">${this.escapeHtml(review.subject)}</div>
                        ${!review.completed ? `
                            <div class="review-mini-actions">
                                <button class="btn btn-success btn-small" onclick="app.completeReview('${review.id}', 'flashcard')">
                                    Flashcard
                                </button>
                                <button class="btn btn-info btn-small" onclick="app.completeReview('${review.id}', 'simulado')">
                                    Simulado
                                </button>
                                <button class="btn btn-secondary btn-small" onclick="app.completeReview('${review.id}', 'outro')">
                                    Outro
                                </button>
                            </div>
                        ` : `
                            <div class="review-mini-subject" style="color: var(--success); margin-top: 0.5rem;">
                                ‚úì Conclu√≠da
                            </div>
                        `}
                    </div>
                `;
            }

            /**
             * Get current review option from settings
             */
            getReviewOption() {
                const option1Radio = document.getElementById('reviewOption1');
                if (option1Radio && option1Radio.checked) {
                    return '1';
                }
                return '2'; // default
            }

            /**
             * Navigate to previous week
             */
            previousWeek() {
                this.currentWeekOffset--;
                this.renderWeeklyAgenda();
            }

            /**
             * Navigate to next week
             */
            nextWeek() {
                this.currentWeekOffset++;
                this.renderWeeklyAgenda();
            }

            /**
             * Go to current week
             */
            goToCurrentWeek() {
                this.currentWeekOffset = 0;
                this.renderWeeklyAgenda();
            }

            /**
             * Escape HTML to prevent XSS
             */
            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
        }

        /**
         * Pomodoro Timer Class
         */
        class PomodoroTimer {
            constructor() {
                this.levels = {
                    beginner: { focus: 25, break: 5, longBreak: 15 },
                    intermediate: { focus: 30, break: 5, longBreak: 15 },
                    advanced: { focus: 45, break: 10, longBreak: 15 },
                    expert: { focus: 60, break: 15, longBreak: 15 }
                };

                this.currentLevel = 'beginner';
                this.timeLeft = 25 * 60; // seconds
                this.totalTime = 25 * 60;
                this.isRunning = false;
                this.isPaused = false;
                this.currentSession = 1;
                this.maxSessions = 4;
                this.isBreak = false;
                this.timer = null;
                this.sessions = [];
                this.currentSubject = '';
                this.currentContent = '';

                // Timestamp-based timer properties
                this.startTimestamp = null;
                this.endTimestamp = null;
                this.pausedAt = null;
                this.totalPausedTime = 0;

                this.init();
                this.restoreState();
            }

            init() {
                // Level buttons
                document.querySelectorAll('.level-btn').forEach(btn => {
                    btn.addEventListener('click', async () => {
                        if (this.isRunning && !this.isPaused) {
                            await this.showPomodoroAlert('Pause o timer antes de mudar de n√≠vel');
                            return;
                        }

                        document.querySelectorAll('.level-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        this.currentLevel = btn.dataset.level;
                        this.reset();
                    });
                });

                // Control buttons
                document.getElementById('startPomodoroBtn').addEventListener('click', () => this.start());
                document.getElementById('pausePomodoroBtn').addEventListener('click', () => this.pause());
                document.getElementById('resumePomodoroBtn').addEventListener('click', () => this.resume());
                document.getElementById('resetPomodoroBtn').addEventListener('click', () => this.reset());

                // Page visibility change listener - handle tab switching
                document.addEventListener('visibilitychange', () => {
                    if (!document.hidden && this.isRunning) {
                        // User returned to the tab, recalculate time
                        this.updateTimerFromTimestamp();
                    }
                });

                // Before unload - save state
                window.addEventListener('beforeunload', () => {
                    if (this.isRunning || this.isPaused) {
                        this.saveState();
                    }
                });

                this.updateDisplay();
                this.loadTodaySessions();
            }

            async start() {
                const subject = document.getElementById('pomodoroSubject').value.trim();
                const content = document.getElementById('pomodoroContent').value.trim();

                if (!subject || !content) {
                    await this.showPomodoroAlert('Por favor, preencha a mat√©ria e o conte√∫do antes de iniciar');
                    return;
                }

                // Show integration modal first
                this.showIntegrationModal(subject, content);
            }

            startTimerAfterIntegration(createSession = false) {
                const subject = document.getElementById('pomodoroSubject').value.trim();
                const content = document.getElementById('pomodoroContent').value.trim();

                this.currentSubject = subject;
                this.currentContent = content;
                this.isRunning = true;
                this.isPaused = false;

                // Initialize timestamp-based timer
                const now = Date.now();
                this.startTimestamp = now;
                this.endTimestamp = now + (this.timeLeft * 1000);
                this.pausedAt = null;
                this.totalPausedTime = 0;

                // If user wants to integrate, create a study session
                if (createSession && window.app) {
                    try {
                        // Create study session automatically
                        const dateNow = new Date();
                        const startTime = dateNow.toTimeString().slice(0, 5);
                        const endTime = new Date(dateNow.getTime() + this.levels[this.currentLevel].focus * 60000).toTimeString().slice(0, 5);

                        // Find the content in app data
                        const contentObj = window.app.data.contents.find(c =>
                            c.title === content && c.subject === subject
                        );

                        if (contentObj) {
                            const durationMinutes = this.levels[this.currentLevel].focus;
                            const session = {
                                id: Date.now(),
                                contentId: contentObj.id,
                                contentTitle: contentObj.title,
                                subject: contentObj.subject,
                                date: dateNow.toISOString().split('T')[0],
                                startTime: startTime,
                                endTime: endTime,
                                duration: durationMinutes,
                                createdAt: new Date().toISOString()
                            };

                            window.app.data.studySessions.push(session);
                            window.app.saveData();
                            window.app.render();
                        }
                    } catch (e) {
                        console.log('Erro ao criar sess√£o de estudo:', e);
                    }
                }

                document.getElementById('startPomodoroBtn').style.display = 'none';
                document.getElementById('pausePomodoroBtn').style.display = 'inline-flex';
                document.getElementById('resumePomodoroBtn').style.display = 'none';

                this.saveState();
                this.runTimer();
            }

            showIntegrationModal(subject, content) {
                const modal = document.getElementById('pomodoroAssociationModal');
                const yesBtn = document.getElementById('pomodoroAssociationYes');
                const noBtn = document.getElementById('pomodoroAssociationNo');

                // Show modal
                modal.classList.add('show');

                // Remove any existing listeners
                const newYesBtn = yesBtn.cloneNode(true);
                const newNoBtn = noBtn.cloneNode(true);
                yesBtn.parentNode.replaceChild(newYesBtn, yesBtn);
                noBtn.parentNode.replaceChild(newNoBtn, noBtn);

                // Handle YES - integrate with study session
                newYesBtn.addEventListener('click', () => {
                    modal.classList.remove('show');
                    this.startTimerAfterIntegration(true);
                }, { once: true });

                // Handle NO - just start timer
                newNoBtn.addEventListener('click', () => {
                    modal.classList.remove('show');
                    this.startTimerAfterIntegration(false);
                }, { once: true });
            }

            pause() {
                this.isPaused = true;
                this.isRunning = false;
                this.pausedAt = Date.now();
                clearInterval(this.timer);

                document.getElementById('pausePomodoroBtn').style.display = 'none';
                document.getElementById('resumePomodoroBtn').style.display = 'inline-flex';

                this.saveState();
            }

            resume() {
                this.isPaused = false;
                this.isRunning = true;

                // Calculate total paused time
                if (this.pausedAt) {
                    this.totalPausedTime += Date.now() - this.pausedAt;
                    this.pausedAt = null;
                }

                // Recalculate end timestamp
                this.endTimestamp = Date.now() + (this.timeLeft * 1000);

                document.getElementById('resumePomodoroBtn').style.display = 'none';
                document.getElementById('pausePomodoroBtn').style.display = 'inline-flex';

                this.saveState();
                this.runTimer();
            }

            reset() {
                this.isRunning = false;
                this.isPaused = false;
                this.currentSession = 1;
                this.isBreak = false;
                clearInterval(this.timer);

                const level = this.levels[this.currentLevel];
                this.timeLeft = level.focus * 60;
                this.totalTime = level.focus * 60;

                // Reset timestamp properties
                this.startTimestamp = null;
                this.endTimestamp = null;
                this.pausedAt = null;
                this.totalPausedTime = 0;

                document.getElementById('startPomodoroBtn').style.display = 'inline-flex';
                document.getElementById('pausePomodoroBtn').style.display = 'none';
                document.getElementById('resumePomodoroBtn').style.display = 'none';

                // Clear saved state
                localStorage.removeItem('pomodoroTimerState');

                this.updateDisplay();
            }

            runTimer() {
                // Clear any existing timer to prevent multiple intervals
                clearInterval(this.timer);

                this.timer = setInterval(() => {
                    try {
                        // Calculate time left based on timestamp
                        this.updateTimerFromTimestamp();

                        if (this.timeLeft <= 0) {
                            this.handleTimerComplete();
                        }
                    } catch (error) {
                        console.error('Erro no timer Pomodoro:', error);
                        // Continue executando mesmo se houver erro
                    }
                }, 1000);
            }

            updateTimerFromTimestamp() {
                if (!this.endTimestamp || !this.isRunning) {
                    return;
                }

                const now = Date.now();
                const remaining = Math.max(0, Math.floor((this.endTimestamp - now) / 1000));

                this.timeLeft = remaining;
                this.updateDisplay();
                this.saveState();
            }

            async handleTimerComplete() {
                try {
                    clearInterval(this.timer);
                    const level = this.levels[this.currentLevel];

                    if (!this.isBreak) {
                        // Completed a focus session
                        this.saveSession();

                        // Play notification sound (optional)
                        try {
                            this.playNotification();
                        } catch (e) {
                            console.log('Erro ao tocar notifica√ß√£o:', e);
                        }

                        // Show notification
                        try {
                            this.showNotification('‚úÖ Sess√£o completa!', 'Verifique a notifica√ß√£o do Pomodoro.');
                        } catch (e) {
                            console.log('Erro ao mostrar notifica√ß√£o:', e);
                        }

                        // Ask if user wants to continue using modal
                        this.showConfirmationModal();
                    } else {
                        // Completed a break - start next session automatically
                        this.currentSession++;
                        try {
                            this.showNotification('üí™ Pausa terminada!', `Iniciando sess√£o ${this.currentSession}!`);
                        } catch (e) {
                            console.log('Erro ao mostrar notifica√ß√£o:', e);
                        }
                        this.timeLeft = level.focus * 60;
                        this.totalTime = level.focus * 60;
                        this.isBreak = false;

                        // Reset timestamps for next focus session
                        const now = Date.now();
                        this.startTimestamp = now;
                        this.endTimestamp = now + (this.timeLeft * 1000);
                        this.totalPausedTime = 0;

                        this.updateDisplay();
                        this.saveState();
                        this.runTimer();
                    }
                } catch (error) {
                    console.error('Erro ao completar timer:', error);
                    // Garantir que o timer n√£o fique travado
                    this.reset();
                }
            }

            showConfirmationModal() {
                const modal = document.getElementById('pomodoroModal');
                const modalIcon = document.getElementById('pomodoroModalIcon');
                const modalTitle = document.getElementById('pomodoroModalTitle');
                const modalMessage = document.getElementById('pomodoroModalMessage');
                const continueBtn = document.getElementById('pomodoroModalContinue');
                const stopBtn = document.getElementById('pomodoroModalStop');

                // Update modal content
                modalIcon.textContent = '‚úÖ';
                modalTitle.textContent = `Sess√£o ${this.currentSession} Completa!`;
                modalMessage.innerHTML = `Parab√©ns! Voc√™ completou uma sess√£o de estudo.<br>Deseja fazer mais uma sess√£o? (m√°ximo 4 sess√µes)`;

                // Show modal
                modal.classList.add('show');

                // Handle continue button
                const handleContinue = () => {
                    modal.classList.remove('show');
                    this.handleContinueSession();
                    cleanup();
                };

                // Handle stop button
                const handleStop = () => {
                    modal.classList.remove('show');
                    this.handleStopSession();
                    cleanup();
                };

                // Cleanup event listeners
                const cleanup = () => {
                    continueBtn.removeEventListener('click', handleContinue);
                    stopBtn.removeEventListener('click', handleStop);
                };

                continueBtn.addEventListener('click', handleContinue);
                stopBtn.addEventListener('click', handleStop);
            }

            handleContinueSession() {
                const level = this.levels[this.currentLevel];

                if (this.currentSession < this.maxSessions) {
                    // User wants to continue - start break
                    this.showNotification('üíö √ìtimo!', `Fa√ßa uma pausa de ${level.break} minutos antes da pr√≥xima sess√£o.`);
                    this.timeLeft = level.break * 60;
                    this.totalTime = level.break * 60;
                    this.isBreak = true;

                    // Reset timestamps for break
                    const now = Date.now();
                    this.startTimestamp = now;
                    this.endTimestamp = now + (this.timeLeft * 1000);
                    this.totalPausedTime = 0;

                    this.updateDisplay();
                    this.saveState();
                    this.runTimer();
                } else {
                    // Reached max sessions
                    this.showNotification('üèÜ M√°ximo atingido!', 'Voc√™ j√° completou o m√°ximo de 4 sess√µes! Excelente trabalho!');
                    this.reset();
                }
            }

            handleStopSession() {
                // User doesn't want to continue
                this.showNotification('üéâ Excelente trabalho!', 'Suas sess√µes foram salvas.');
                this.reset();
            }

            showNotification(title, message) {
                // Try to use browser notification API if available
                if ('Notification' in window && Notification.permission === 'granted') {
                    new Notification(title, {
                        body: message,
                        icon: '/favicon.ico'
                    });
                }
            }

            updateDisplay() {
                const minutes = Math.floor(this.timeLeft / 60);
                const seconds = this.timeLeft % 60;
                const display = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

                document.getElementById('timerDisplay').textContent = display;
                document.getElementById('timerType').textContent = this.isBreak ? 'Descanso' : 'Foco';
                document.getElementById('sessionInfo').textContent = `Sess√£o ${this.currentSession} de ${this.maxSessions}`;

                // Update progress bar
                const progress = ((this.totalTime - this.timeLeft) / this.totalTime) * 100;
                document.getElementById('pomodoroProgress').style.width = `${progress}%`;

                // Update page title
                if (this.isRunning || this.isPaused) {
                    document.title = `${display} - ${this.isBreak ? 'Descanso' : 'Foco'} - MedLife`;
                }
            }

            saveSession() {
                const session = {
                    subject: this.currentSubject,
                    content: this.currentContent,
                    level: this.currentLevel,
                    duration: this.levels[this.currentLevel].focus,
                    timestamp: new Date().toISOString(),
                    date: new Date().toLocaleDateString('pt-BR')
                };

                const sessions = JSON.parse(localStorage.getItem('pomodoroSessions') || '[]');
                sessions.push(session);
                localStorage.setItem('pomodoroSessions', JSON.stringify(sessions));

                this.loadTodaySessions();
            }

            loadTodaySessions() {
                const sessions = JSON.parse(localStorage.getItem('pomodoroSessions') || '[]');
                const today = new Date().toLocaleDateString('pt-BR');
                const todaySessions = sessions.filter(s => s.date === today);

                const container = document.getElementById('todayPomodoroList');

                if (todaySessions.length === 0) {
                    container.innerHTML = '<p style="color: var(--text-secondary); text-align: center; padding: 20px;">Nenhuma sess√£o Pomodoro hoje. Comece agora! üöÄ</p>';
                    return;
                }

                const totalMinutes = todaySessions.reduce((sum, s) => sum + s.duration, 0);

                container.innerHTML = `
                    <div style="background: var(--bg-secondary); padding: 16px; border-radius: var(--radius); margin-bottom: 16px; text-align: center;">
                        <div style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 4px;">Total de hoje</div>
                        <div style="font-size: 2rem; font-weight: 700; color: var(--primary);">${totalMinutes} min</div>
                        <div style="font-size: 0.85rem; color: var(--text-secondary);">${todaySessions.length} sess√µes completadas</div>
                    </div>
                    ${todaySessions.reverse().map(session => `
                        <div class="pomodoro-session-item">
                            <div class="pomodoro-session-details">
                                <div class="pomodoro-session-title">${session.subject}</div>
                                <div class="pomodoro-session-meta">
                                    <span>üìö ${session.content}</span>
                                    <span>‚è±Ô∏è ${session.duration} min</span>
                                    <span>üéØ ${this.getLevelName(session.level)}</span>
                                    <span>üïê ${new Date(session.timestamp).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}</span>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                `;
            }

            getLevelName(level) {
                const names = {
                    beginner: 'Iniciante',
                    intermediate: 'Intermedi√°rio',
                    advanced: 'Avan√ßado',
                    expert: 'Super Avan√ßado'
                };
                return names[level] || level;
            }

            /**
             * Show confirmation dialog using custom modal
             * @param {string} message - Message to display
             * @returns {Promise<boolean>} - Promise that resolves to true if confirmed, false otherwise
             */
            showPomodoroConfirm(message) {
                return new Promise((resolve) => {
                    const modal = document.getElementById('modalOverlay');
                    const title = document.getElementById('modalTitle');
                    const body = document.getElementById('modalBody');
                    const confirmBtn = document.getElementById('modalConfirm');
                    const cancelBtn = document.getElementById('modalCancel');

                    // Set content
                    title.textContent = 'Pomodoro';
                    body.textContent = message;

                    // Update confirm button style for positive action
                    confirmBtn.textContent = 'Sim';
                    confirmBtn.className = 'btn btn-primary';
                    cancelBtn.textContent = 'N√£o';

                    // Show modal
                    modal.classList.add('show');

                    // Handle confirm
                    const handleConfirm = () => {
                        cleanup();
                        resolve(true);
                    };

                    // Handle cancel
                    const handleCancel = () => {
                        cleanup();
                        resolve(false);
                    };

                    // Cleanup function
                    const cleanup = () => {
                        modal.classList.remove('show');
                        confirmBtn.removeEventListener('click', handleConfirm);
                        cancelBtn.removeEventListener('click', handleCancel);
                        modal.removeEventListener('click', handleOverlayClick);
                    };

                    // Handle overlay click
                    const handleOverlayClick = (e) => {
                        if (e.target === modal) {
                            handleCancel();
                        }
                    };

                    // Add event listeners
                    confirmBtn.addEventListener('click', handleConfirm);
                    cancelBtn.addEventListener('click', handleCancel);
                    modal.addEventListener('click', handleOverlayClick);
                });
            }

            /**
             * Show alert dialog using custom modal
             * @param {string} message - Message to display
             * @returns {Promise<void>} - Promise that resolves when user closes the alert
             */
            showPomodoroAlert(message) {
                return new Promise((resolve) => {
                    const modal = document.getElementById('modalOverlay');
                    const title = document.getElementById('modalTitle');
                    const body = document.getElementById('modalBody');
                    const confirmBtn = document.getElementById('modalConfirm');
                    const cancelBtn = document.getElementById('modalCancel');

                    // Set content
                    title.textContent = 'Pomodoro';
                    body.textContent = message;

                    // Update buttons for alert (only show OK button)
                    confirmBtn.textContent = 'OK';
                    confirmBtn.className = 'btn btn-primary';
                    cancelBtn.style.display = 'none';

                    // Show modal
                    modal.classList.add('show');

                    // Handle confirm
                    const handleConfirm = () => {
                        cleanup();
                        resolve();
                    };

                    // Cleanup function
                    const cleanup = () => {
                        modal.classList.remove('show');
                        cancelBtn.style.display = ''; // Restore cancel button
                        confirmBtn.removeEventListener('click', handleConfirm);
                        modal.removeEventListener('click', handleOverlayClick);
                    };

                    // Handle overlay click
                    const handleOverlayClick = (e) => {
                        if (e.target === modal) {
                            handleConfirm();
                        }
                    };

                    // Add event listeners
                    confirmBtn.addEventListener('click', handleConfirm);
                    modal.addEventListener('click', handleOverlayClick);
                });
            }

            saveState() {
                const state = {
                    currentLevel: this.currentLevel,
                    timeLeft: this.timeLeft,
                    totalTime: this.totalTime,
                    isRunning: this.isRunning,
                    isPaused: this.isPaused,
                    currentSession: this.currentSession,
                    isBreak: this.isBreak,
                    currentSubject: this.currentSubject,
                    currentContent: this.currentContent,
                    startTimestamp: this.startTimestamp,
                    endTimestamp: this.endTimestamp,
                    pausedAt: this.pausedAt,
                    totalPausedTime: this.totalPausedTime
                };

                try {
                    localStorage.setItem('pomodoroTimerState', JSON.stringify(state));
                } catch (e) {
                    console.error('Erro ao salvar estado do timer:', e);
                }
            }

            restoreState() {
                try {
                    const savedState = localStorage.getItem('pomodoroTimerState');
                    if (!savedState) return;

                    const state = JSON.parse(savedState);

                    // Restore basic properties
                    this.currentLevel = state.currentLevel || 'beginner';
                    this.currentSession = state.currentSession || 1;
                    this.isBreak = state.isBreak || false;
                    this.currentSubject = state.currentSubject || '';
                    this.currentContent = state.currentContent || '';
                    this.totalTime = state.totalTime || 25 * 60;
                    this.totalPausedTime = state.totalPausedTime || 0;

                    // Restore timestamps
                    this.startTimestamp = state.startTimestamp;
                    this.endTimestamp = state.endTimestamp;
                    this.pausedAt = state.pausedAt;

                    // If timer was running, restore it
                    if (state.isRunning && this.endTimestamp) {
                        const now = Date.now();
                        const remaining = Math.max(0, Math.floor((this.endTimestamp - now) / 1000));

                        if (remaining > 0) {
                            // Timer is still valid
                            this.timeLeft = remaining;
                            this.isRunning = true;
                            this.isPaused = false;

                            document.getElementById('startPomodoroBtn').style.display = 'none';
                            document.getElementById('pausePomodoroBtn').style.display = 'inline-flex';
                            document.getElementById('resumePomodoroBtn').style.display = 'none';

                            // Update level button
                            document.querySelectorAll('.level-btn').forEach(b => b.classList.remove('active'));
                            document.querySelector(`[data-level="${this.currentLevel}"]`)?.classList.add('active');

                            this.runTimer();
                        } else {
                            // Timer expired while away
                            this.reset();
                            localStorage.removeItem('pomodoroTimerState');
                        }
                    } else if (state.isPaused && this.pausedAt) {
                        // Timer was paused
                        this.timeLeft = state.timeLeft;
                        this.isRunning = false;
                        this.isPaused = true;

                        document.getElementById('startPomodoroBtn').style.display = 'none';
                        document.getElementById('pausePomodoroBtn').style.display = 'none';
                        document.getElementById('resumePomodoroBtn').style.display = 'inline-flex';

                        // Update level button
                        document.querySelectorAll('.level-btn').forEach(b => b.classList.remove('active'));
                        document.querySelector(`[data-level="${this.currentLevel}"]`)?.classList.add('active');

                        this.updateDisplay();
                    }
                } catch (e) {
                    console.error('Erro ao restaurar estado do timer:', e);
                    localStorage.removeItem('pomodoroTimerState');
                }
            }

            playNotification() {
                // Simple beep using Web Audio API
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();

                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);

                    oscillator.frequency.value = 800;
                    oscillator.type = 'sine';

                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);

                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.5);
                } catch (e) {
                    console.log('Audio notification not available');
                }
            }
        }

        // Initialize the application
        const app = new StudyPlannerApp();
        window.app = app; // Make app globally accessible for Pomodoro integration
        const pomodoroTimer = new PomodoroTimer();
        window.pomodoroTimer = pomodoroTimer; // Make timer globally accessible
    </script>
</body>
</html>
